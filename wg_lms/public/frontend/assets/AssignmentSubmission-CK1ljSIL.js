import{y as N,p as le,i as K,z as J,aq as ue,c as I,aB as me,a8 as A,J as q,A as de,B as D,a as c,b as p,u as a,o as r,e as n,t as o,n as z,h as x,f as _,w as S,l as F,a1 as G,q as j,by as ce,ci as fe,bz as be,bA as ve,L as O,ai as H,x as ge,E as pe,F as _e}from"./index-CZIp1LU6.js";import{_ as ye}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-B2fdcvTt.js";const he={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},we={key:0},ke={key:1},xe={class:"text-sm text-ink-gray-7 font-medium mb-2"},Se=["innerHTML"],Ne={class:"flex flex-col"},De={class:"p-5"},Le={class:"flex items-center justify-between mb-4"},Ae={class:"font-semibold text-ink-gray-9"},Fe={class:"flex items-center space-x-2"},Ie={key:0,class:"bg-surface-blue-2 text-ink-blue-2 p-3 rounded-md leading-5 text-sm mb-4"},Te={key:1},Ce={class:"text-xs text-ink-gray-5 mt-1 mb-2"},Re={key:1},Me={class:"flex text-ink-gray-7"},Pe={class:"border self-start rounded-md p-2 mr-2"},$e=["href"],Ve={class:"text-sm leading-5"},Ue={class:"text-sm text-ink-gray-5 mt-1"},Be={key:2},Ee={class:"text-xs text-ink-gray-5 mb-1"},qe={key:3},ze={class:"text-sm mb-2 text-ink-gray-7"},Ge={key:4,class:"mt-8 p-3 bg-surface-blue-2 rounded-md"},je={class:"text-sm text-ink-gray-5 font-medium mb-2"},Oe=["innerHTML"],He={key:5,class:"mt-8 space-y-4"},Ke={class:"font-semibold mb-2 text-ink-gray-9"},Je={class:"text-sm text-ink-gray-5 mb-1"},Qe={__name:"Assignment",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"},showTitle:{type:Boolean,default:!0}},setup(g){var M;const u=N(null),f=N(null),w=N(null),b=le(),m=K("$user"),v=N(!1),d=g;J(()=>{window.addEventListener("keydown",k)});const k=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(C(),e.preventDefault())};ue(()=>{window.removeEventListener("keydown",k)});const y=I({url:"frappe.client.get",params:{doctype:"LMS Assignment",name:d.assignmentID},auto:!0,onSuccess(e){d.submissionName!="new"&&t.reload()}}),Q=I({url:"frappe.client.insert",makeParams(e){var i;let s={doctype:"LMS Assignment Submission",assignment:d.assignmentID,member:(i=m.data)==null?void 0:i.name};return L()?s.assignment_attachment=u.value.file_url:s.answer=f.value,{doc:s}}}),W=I({url:"wg_lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){u.value=e}}),t=me({doctype:"LMS Assignment Submission",name:d.submissionName,onError(e){var s;A.error(((s=e.messages)==null?void 0:s[0])||e)},auto:!1,cache:[(M=m.data)==null?void 0:M.name,d.assignmentID]});q(t,()=>{t.doc&&(t.doc.assignment_attachment&&W.reload({image:t.doc.assignment_attachment}),t.doc.answer&&(f.value=t.doc.answer),t.doc.comments&&(w.value=t.doc.comments),t.isDirty||L()&&!u.value||!L()&&!f.value?v.value=!0:v.value=!1)}),q(u,()=>{d.submissionName=="new"&&u.value&&(v.value=!0)});const C=()=>{var e,s,i;if(d.submissionName!="new"){let h=t.doc&&t.doc.owner!=((e=m.data)==null?void 0:e.name)?(s=m.data)==null?void 0:s.name:null;t.setValue.submit({...t.doc,assignment_attachment:(i=u.value)==null?void 0:i.file_url,evaluator:h,comments:w.value,answer:f.value},{onSuccess(T){A.success(__("Changes saved successfully"))}})}else X()},X=()=>{Q.submit({},{onSuccess(e){A.success(__("Assignment submitted successfully")),b.currentRoute.value.name=="AssignmentSubmission"?b.push({name:"AssignmentSubmission",params:{assignmentID:d.assignmentID,submissionName:e.name},query:{fromLesson:b.currentRoute.value.query.fromLesson}}):(Z(),b.go()),t.name=e.name,t.reload()},onError(e){var s;A.error(((s=e.messages)==null?void 0:s[0])||e)}})},Y=e=>{v.value=!0,u.value=e},Z=()=>{if(b.currentRoute.value.name=="Lesson"){let e=b.currentRoute.value.params.courseName,s=b.currentRoute.value.params.chapterNumber,i=b.currentRoute.value.params.lessonNumber;de("wg_lms.lms.api.mark_lesson_progress",{course:e,chapter_number:s,lesson_number:i})}},ee=()=>{var s;const e=(s=y.data)==null?void 0:s.type;if(e=="Image")return["image/*"];if(e=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(e=="PDF")return[".pdf"]},se=e=>{var h;let s=(h=y.data)==null?void 0:h.type,i=e.name.split(".").pop().toLowerCase();if(s=="Image"&&!["jpg","jpeg","png"].includes(i))return"Only image file is allowed.";if(s=="Document"&&!["doc","docx","xml"].includes(i))return"Only document file is allowed.";if(s=="PDF"&&!["pdf"].includes(i))return"Only PDF file is allowed."},te=()=>{v.value=!0,u.value=null},ae=D(()=>{var e,s,i;return(((e=m.data)==null?void 0:e.is_moderator)||((s=m.data)==null?void 0:s.is_evaluator)||((i=m.data)==null?void 0:i.is_instructor))&&d.submissionName!="new"&&b.currentRoute.value.name=="AssignmentSubmission"}),R=D(()=>{var e,s,i;return!t.doc||((e=t.doc)==null?void 0:e.owner)==((s=m.data)==null?void 0:s.name)&&((i=t.doc)==null?void 0:i.status)=="Not Graded"}),ne=D(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),oe=D(()=>t.doc?t.doc.status=="Pass"?"green":t.doc.status=="Not Graded"?"blue":"red":"orange"),L=()=>{var e;return["PDF","Image","Document"].includes((e=y.data)==null?void 0:e.type)};return(e,s)=>{var i,h,T,P,$,V,U,B,E;return a(y).data?(r(),c("div",{key:0,class:z(["grid grid-cols-2 h-full",{"border rounded-lg overflow-auto":!g.showTitle}])},[n("div",{class:z(["border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]",{"h-full":!g.showTitle}])},[g.showTitle?(r(),c("div",he,[g.submissionName==="new"?(r(),c("div",we,o(e.__("Submission by"))+" "+o((i=a(m).data)==null?void 0:i.full_name),1)):(r(),c("div",ke,o(e.__("Submission by"))+" "+o((h=a(t).doc)==null?void 0:h.member_name),1))])):p("",!0),n("div",xe,o(e.__("Question"))+": ",1),n("div",{innerHTML:a(y).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,Se)],2),n("div",Ne,[n("div",De,[n("div",Le,[n("div",Ae,o(e.__("Submission")),1),n("div",Fe,[v.value?(r(),x(a(G),{key:0,theme:"orange"},{default:S(()=>[F(o(e.__("Not Saved")),1)]),_:1})):(T=a(t).doc)!=null&&T.status?(r(),x(a(G),{key:1,theme:oe.value,size:"lg"},{default:S(()=>{var l;return[F(o((l=a(t).doc)==null?void 0:l.status),1)]}),_:1},8,["theme"])):p("",!0),_(a(j),{variant:"solid",onClick:s[0]||(s[0]=l=>C())},{default:S(()=>[F(o(e.__("Save")),1)]),_:1})])]),g.submissionName!="new"&&!["Pass","Fail"].includes((P=a(t).doc)==null?void 0:P.status)&&(($=a(t).doc)==null?void 0:$.owner)==((V=a(m).data)==null?void 0:V.name)?(r(),c("div",Ie,o(e.__("You've successfully submitted the assignment."))+" "+o(e.__("Once the moderator grades your submission, you'll find the details here."))+" "+o(e.__("Feel free to make edits to your submission if needed.")),1)):p("",!0),L()?(r(),c("div",Te,[n("div",Ce,o(e.__("Add your assignment as {0}").format(a(y).data.type)),1),u.value?(r(),c("div",Re,[n("div",Me,[n("div",Pe,[_(a(fe),{class:"h-5 w-5 stroke-1.5"})]),n("a",{href:u.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[n("span",Ve,o(u.value.file_name),1),n("span",Ue,o(a(be)(u.value.file_size)),1)],8,$e),R.value?(r(),x(a(ve),{key:0,onClick:s[2]||(s[2]=l=>te()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):p("",!0)])])):(r(),x(a(ce),{key:0,fileTypes:ee(),uploadArgs:{private:!0},validateFile:se,onSuccess:s[1]||(s[1]=l=>Y(l))},{default:S(({uploading:l,progress:ie,openFileSelector:re})=>[_(a(j),{onClick:re,loading:l},{default:S(()=>[F(o(l?e.__("Uploading {0}%").format(ie):e.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):a(y).data.type=="URL"?(r(),c("div",Be,[n("div",Ee,o(e.__("Enter a URL")),1),_(a(O),{modelValue:f.value,"onUpdate:modelValue":s[3]||(s[3]=l=>f.value=l),type:"text",readonly:!R.value},null,8,["modelValue","readonly"])])):(r(),c("div",qe,[n("div",ze,o(e.__("Write your answer here")),1),_(a(H),{content:f.value,onChange:s[4]||(s[4]=l=>f.value=l),editable:!0,fixedMenu:!0,uploadArgs:{private:!0},editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),((U=a(m).data)==null?void 0:U.name)==((B=a(t).doc)==null?void 0:B.owner)&&((E=a(t).doc)!=null&&E.comments)?(r(),c("div",Ge,[n("div",je,o(e.__("Comments by Evaluator"))+": ",1),n("div",{class:"leading-5 text-ink-gray-9",innerHTML:a(t).doc.comments},null,8,Oe)])):p("",!0),ae.value?(r(),c("div",He,[n("div",Ke,o(e.__("Grading")),1),a(t).doc?(r(),x(a(O),{key:0,modelValue:a(t).doc.status,"onUpdate:modelValue":s[5]||(s[5]=l=>a(t).doc.status=l),label:e.__("Grade"),type:"select",options:ne.value},null,8,["modelValue","label","options"])):p("",!0),n("div",null,[n("div",Je,o(e.__("Comments")),1),_(a(H),{content:w.value,onChange:s[6]||(s[6]=l=>{w.value=l,v.value=!0}),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])):p("",!0)])])],2)):p("",!0)}}},We={key:0,class:"flex justify-between sticky top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},Xe={class:"overflow-hidden h-[calc(100vh-3.2rem)]"},es={__name:"AssignmentSubmission",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(g){const u=K("$user"),f=N(!1),{brand:w}=ge(),b=g,m=I({url:"frappe.client.get_value",params:{doctype:"LMS Assignment",fieldname:"title",filters:{name:b.assignmentID}},auto:!0});J(()=>{u.data||(window.location.href="/login"),new URLSearchParams(window.location.search).get("fromLesson")&&(f.value=!0)});const v=D(()=>{var k;return[{label:"Submissions",route:{name:"AssignmentSubmissionList"}},{label:(k=m.data)==null?void 0:k.title,route:{name:"AssignmentSubmission",params:{assignmentID:b.assignmentID}}}]});return pe(()=>{var d;return{title:(d=m.data)==null?void 0:d.title,icon:w.favicon}}),(d,k)=>(r(),c(_e,null,[f.value?p("",!0):(r(),c("header",We,[_(a(ye),{items:v.value},null,8,["items"])])),n("div",Xe,[_(Qe,{assignmentID:g.assignmentID,submissionName:g.submissionName,showTitle:!f.value},null,8,["assignmentID","submissionName","showTitle"])])],64))}};export{es as default};
//# sourceMappingURL=AssignmentSubmission-CK1ljSIL.js.map
