{"version":3,"file":"Notifications-UeSoa6zd.js","sources":["../../../../frontend/node_modules/frappe-ui/src/components/Link.vue","../../../../frontend/src/pages/Notifications.vue"],"sourcesContent":["<template>\n  <component\n    :is=\"isExternal ? 'a' : 'router-link'\"\n    v-bind=\"attributes\"\n    class=\"cursor-pointer text-blue-500 hover:text-blue-600\"\n  >\n    <slot></slot>\n  </component>\n</template>\n\n<script>\nexport default {\n  props: ['to'],\n  computed: {\n    attributes() {\n      return {\n        ...this.$attrs,\n        target: this.isExternal ? '_blank' : null,\n        to: !this.isExternal ? this.to : undefined,\n        href: this.isExternal ? this.to : undefined,\n      }\n    },\n    isExternal() {\n      return this.to.startsWith('http')\n    },\n  },\n}\n</script>\n","<template>\n\t<header\n\t\tclass=\"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t<Button\n\t\t\t\t@click=\"markAllAsRead.submit\"\n\t\t\t\t:loading=\"markAllAsRead.loading\"\n\t\t\t\tv-if=\"activeTab === 'Unread' && unReadNotifications.data?.length > 0\"\n\t\t\t>\n\t\t\t\t{{ __('Mark all as read') }}\n\t\t\t</Button>\n\t\t\t<TabButtons\n\t\t\t\tclass=\"inline-block\"\n\t\t\t\t:buttons=\"[{ label: 'Unread', active: true }, { label: 'Read' }]\"\n\t\t\t\tv-model=\"activeTab\"\n\t\t\t/>\n\t\t</div>\n\t</header>\n\t<div class=\"w-full md:w-3/4 mx-auto px-5 pt-6 divide-y\">\n\t\t<div\n\t\t\tv-if=\"notifications?.length\"\n\t\t\tv-for=\"log in notifications\"\n\t\t\t:key=\"log.name\"\n\t\t\tclass=\"flex items-center py-2 justify-between\"\n\t\t>\n\t\t\t<div class=\"flex items-center\">\n\t\t\t\t<Avatar :image=\"log.user_image\" :label=\"log.full_name\" class=\"mr-2\" />\n\t\t\t\t<div class=\"notification text-ink-gray-7\" v-html=\"log.subject\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t<Link\n\t\t\t\t\tv-if=\"log.link\"\n\t\t\t\t\t:to=\"log.link\"\n\t\t\t\t\t@click=\"(e) => handleMarkAsRead(e, log.name)\"\n\t\t\t\t\tclass=\"text-ink-gray-5 font-medium text-sm hover:text-ink-gray-7\"\n\t\t\t\t>\n\t\t\t\t\t{{ __('View') }}\n\t\t\t\t</Link>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tv-if=\"!log.read\"\n\t\t\t\t\t@click.stop=\"(e) => handleMarkAsRead(e, log.name)\"\n\t\t\t\t>\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<X class=\"h-4 w-4 text-ink-gray-7 stroke-1.5\" />\n\t\t\t\t\t</template>\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-else class=\"text-ink-gray-5\">\n\t\t\t{{ __('Nothing to see here.') }}\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tAvatar,\n\tcreateListResource,\n\tcreateResource,\n\tBreadcrumbs,\n\tLink,\n\tTabButtons,\n\tButton,\n\tusePageMeta,\n} from 'frappe-ui'\nimport { sessionStore } from '../stores/session'\nimport { computed, inject, ref, onMounted, onUnmounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { X } from 'lucide-vue-next'\n\nconst { brand } = sessionStore()\nconst user = inject('$user')\nconst socket = inject('$socket')\nconst activeTab = ref('Unread')\nconst router = useRouter()\n\nonMounted(() => {\n\tif (!user.data) router.push({ name: 'Courses' })\n\n\tsocket.on('publish_lms_notifications', (data) => {\n\t\tunReadNotifications.reload()\n\t})\n})\n\nconst notifications = computed(() => {\n\treturn activeTab.value === 'Unread'\n\t\t? unReadNotifications.data\n\t\t: readNotifications.data\n})\n\nconst unReadNotifications = createListResource({\n\tdoctype: 'Notification Log',\n\turl: 'lms.lms.api.get_notifications',\n\tfilters: {\n\t\tfor_user: user.data?.name,\n\t\tread: 0,\n\t},\n\tauto: true,\n\tcache: 'Unread Notifications',\n})\n\nconst readNotifications = createListResource({\n\tdoctype: 'Notification Log',\n\turl: 'lms.lms.api.get_notifications',\n\tfilters: {\n\t\tfor_user: user.data?.name,\n\t\tread: 1,\n\t},\n\tauto: true,\n\tcache: 'Read Notifications',\n})\n\nconst markAsRead = createResource({\n\turl: 'lms.lms.api.mark_as_read',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tname: values.name,\n\t\t}\n\t},\n\tonSuccess(data) {\n\t\tunReadNotifications.reload()\n\t\treadNotifications.reload()\n\t},\n})\n\nconst markAllAsRead = createResource({\n\turl: 'lms.lms.api.mark_all_as_read',\n\tonSuccess(data) {\n\t\tunReadNotifications.reload()\n\t\treadNotifications.reload()\n\t},\n})\n\nconst handleMarkAsRead = (e, logName) => {\n\tmarkAsRead.submit({ name: logName })\n}\n\nonUnmounted(() => {\n\tsocket.off('publish_lms_notifications')\n})\n\nconst breadcrumbs = computed(() => {\n\tlet crumbs = [\n\t\t{\n\t\t\tlabel: 'Notifications',\n\t\t\troute: {\n\t\t\t\tname: 'Notifications',\n\t\t\t},\n\t\t},\n\t]\n\treturn crumbs\n})\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: 'Notifications',\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n<style>\n.notification strong {\n\tfont-weight: 400;\n}\n.notification b {\n\tfont-weight: 400;\n}\n</style>\n"],"names":["_sfc_main","_createBlock","_resolveDynamicComponent","$options","_mergeProps","_renderSlot","_ctx","brand","sessionStore","user","inject","socket","activeTab","ref","router","useRouter","onMounted","data","unReadNotifications","notifications","computed","readNotifications","createListResource","_a","_b","markAsRead","createResource","values","markAllAsRead","handleMarkAsRead","e","logName","onUnmounted","breadcrumbs","usePageMeta","_createElementVNode","_hoisted_1","_createVNode","_unref","Breadcrumbs","_hoisted_2","Button","__","TabButtons","$event","_hoisted_3","_createElementBlock","_Fragment","_renderList","log","_hoisted_4","Avatar","_hoisted_6","Link","_withModifiers","X","_hoisted_7","_toDisplayString"],"mappings":"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","x_google_ignoreList":[0]}