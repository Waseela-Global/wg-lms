import{i as S,y as i,x as X,z as Z,H as ee,A as k,J as te,B as L,E as ae,r as le,a as h,o as c,e as v,f as p,h as C,b as w,u as s,K as se,w as b,q as F,l as U,t as x,P as oe,L as N,N as re,F as P,g as ue,O as ne}from"./index-CZIp1LU6.js";import{_ as ie}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-B2fdcvTt.js";import{T as de}from"./TabButtons-B8hLfXVF.js";import{_ as ce}from"./CourseCard-Dy3xQuBt.js";import{_ as pe}from"./EmptyState.vue_vue_type_script_setup_true_lang-Cua88j6p.js";import"./CourseInstructors-Dfde5EU7.js";import"./UserAvatar-D_gN1iLa.js";const ve={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},me={class:"p-5 pb-10"},fe={class:"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5"},ge={class:"text-lg text-ink-gray-9 font-semibold"},_e={class:"flex flex-col space-y-3 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-4"},ye={class:"grid grid-cols-2 gap-2"},be={class:"w-full lg:min-w-0 lg:w-32 xl:w-40"},he={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-8"},Ce={key:2,class:"flex justify-center mt-5"},Ue={__name:"Courses",setup(we){var $;const u=S("$user"),M=S("$dayjs"),T=i(0),j=i(30),m=i([]),f=i(null),g=i(""),_=i(!1),a=i({}),n=i("Live"),{brand:E}=X(),V=i(0);Z(()=>{B(),y(),O(),m.value=[{label:"",value:null}]});const B=()=>{let e=new URLSearchParams(location.search);g.value=e.get("title")||"",f.value=e.get("category")||null,_.value=e.get("certification")||!1},d=ee({doctype:"LMS Course",url:"wg_lms.lms.utils.get_courses",cache:["courses",($=u.data)==null?void 0:$.name],pageLength:j.value,start:T.value,onSuccess(e){q(e)}}),q=e=>{let t=e.map(l=>l.category);t=t.filter((l,r)=>t.indexOf(l)===r&&l),m.value.length<=t.length&&J(e)},D=async()=>await k("frappe.client.get_single_value",{doctype:"LMS Settings",field:"persona_captured"}),Y=async()=>{var e,t;if((e=u.data)!=null&&e.is_system_manager&&!((t=u.data)!=null&&t.developer_mode)){if(await D())return;V.value||ne.push({name:"PersonaForm"})}},O=()=>{u.data&&k("frappe.client.get_count",{doctype:"LMS Course"}).then(e=>{V.value=e,Y()})},y=()=>{R(),d.update({filters:a.value}),d.reload()},R=()=>{z(),A(),K(),Q(),H(),I()},z=()=>{f.value?a.value.category=f.value:delete a.value.category},A=()=>{g.value?a.value.title=["like",`%${g.value}%`]:delete a.value.title},K=()=>{_.value?a.value.certification=1:delete a.value.certification},Q=()=>{var e;delete a.value.live,delete a.value.created,delete a.value.published_on,delete a.value.upcoming,n.value=="Enrolled"&&((e=u.data)!=null&&e.is_student)?(a.value.enrolled=1,delete a.value.published):(delete a.value.published,delete a.value.enrolled,n.value=="Live"?(a.value.published=1,a.value.upcoming=0,a.value.live=1):n.value=="Upcoming"?a.value.upcoming=1:n.value=="New"?(a.value.published=1,a.value.published_on=[">=",M().add(-3,"month").format("YYYY-MM-DD")]):n.value=="Created"?a.value.created=1:n.value=="Unpublished"&&(a.value.published=0))},H=()=>{var e;(!u.data||(e=u.data)!=null&&e.is_student&&n.value!="Enrolled")&&(a.value.published=1)},I=()=>{let e=new URLSearchParams(location.search),t={title:g.value,category:f.value,certification:_.value};Object.keys(t).forEach(r=>{t[r]?e.set(r,t[r]):e.delete(r)});let l="";e.toString()&&(l=`?${e.toString()}`),history.replaceState({},"",`${location.pathname}${l}`)},J=e=>{e.forEach(t=>{t.category&&!m.value.find(l=>l.value===t.category)&&m.value.push({label:t.category,value:t.category})})};te(n,()=>{y()});const G=L(()=>{var t,l,r;let e=[{label:__("Live")},{label:__("New")},{label:__("Upcoming")}];return(t=u.data)!=null&&t.is_moderator||(l=u.data)!=null&&l.is_instructor||(r=u.data)!=null&&r.is_evaluator?(e.push({label:__("Created")}),e.push({label:__("Unpublished")})):u.data&&e.push({label:__("Enrolled")}),e}),W=L(()=>[{label:__("Courses"),route:{name:"Courses"}}]);return ae(()=>({title:__("Courses"),icon:E.favicon})),(e,t)=>{var r;const l=le("router-link");return c(),h(P,null,[v("header",ve,[p(s(ie),{items:W.value},null,8,["items"]),s(se)()?(c(),C(l,{key:0,to:{name:"CourseForm",params:{courseName:"new"}}},{default:b(()=>[p(s(F),{variant:"solid"},{prefix:b(()=>[p(s(oe),{class:"h-4 w-4 stroke-1.5"})]),default:b(()=>[U(" "+x(e.__("Create")),1)]),_:1})]),_:1})):w("",!0)]),v("div",me,[v("div",fe,[v("div",ge,x(e.__("All Courses")),1),v("div",_e,[p(s(de),{buttons:G.value,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),class:"w-fit"},null,8,["buttons","modelValue"]),v("div",ye,[p(s(N),{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=o=>g.value=o),placeholder:e.__("Search by Title"),type:"text",class:"w-full lg:min-w-0 lg:w-32 xl:w-40",onInput:t[2]||(t[2]=o=>y())},null,8,["modelValue","placeholder"]),v("div",be,[m.value.length?(c(),C(s(re),{key:0,modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=o=>f.value=o),options:m.value,placeholder:e.__("Category"),onChange:t[4]||(t[4]=o=>y())},null,8,["modelValue","options","placeholder"])):w("",!0)])]),p(s(N),{modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=o=>_.value=o),label:e.__("Certification"),type:"checkbox",onChange:t[6]||(t[6]=o=>y())},null,8,["modelValue","label"])])]),(r=s(d).data)!=null&&r.length?(c(),h("div",he,[(c(!0),h(P,null,ue(s(d).data,o=>(c(),C(l,{to:{name:"CourseDetail",params:{courseName:o.name}}},{default:b(()=>[p(ce,{course:o},null,8,["course"])]),_:2},1032,["to"]))),256))])):s(d).list.loading?w("",!0):(c(),C(pe,{key:1,type:"Courses"})),!s(d).list.loading&&s(d).hasNextPage?(c(),h("div",Ce,[p(s(F),{onClick:t[7]||(t[7]=o=>s(d).next())},{default:b(()=>[U(x(e.__("Load More")),1)]),_:1})])):w("",!0)])],64)}}};export{Ue as default};
//# sourceMappingURL=Courses-F97f3n45.js.map
