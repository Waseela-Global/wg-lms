import{x as V,ap as D,i as B,y as M,aA as R,aB as A,H as I,c as F,B as q,E as z,a as d,o as p,e as l,b as j,f as N,u as r,t as w,w as O,l as H,q as Y,F as k,A as J}from"./index-CZIp1LU6.js";import{_ as K}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-B2fdcvTt.js";const Q={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},U={key:0},W=["src"],X={key:1},Z={class:"text-center pt-10 px-5 md:px-0 pb-10"},ee={class:"text-center"},te={class:"mb-4"},re={__name:"SCORMChapter",props:{courseName:{type:String,required:!0},chapterName:{type:String,required:!0}},setup(E){var b,v;const{brand:T}=V(),x=D(),c=B("$user"),_=M(!1),i=M(!1),o=E;R(()=>{x.isSidebarCollapsed=!0,P()});const s=A({doctype:"Course Chapter",name:o.chapterName,auto:!0,cache:["chapter",o.chapterName],onSuccess(e){u.submit()}}),m=I({doctype:"LMS Enrollment",fields:["member","course"],filters:{course:o.courseName,member:(b=c.data)==null?void 0:b.name},auto:!0,cache:["enrollments",o.courseName,(v=c.data)==null?void 0:v.name]}),S=e=>{var t,a,n;return e==="cmi.core.lesson_status"?((t=u.data)==null?void 0:t.status)==="Complete"?"passed":"incomplete":e==="cmi.launch_data"?((a=u.data)==null?void 0:a.scorm_content)||"":e==="cmi.suspend_data"&&((n=u.data)==null?void 0:n.scorm_content)||""};let f=null;const G=e=>{clearTimeout(f),f=setTimeout(()=>{g(e)},300)},h=(e,t)=>{e==="cmi.core.lesson_status"?t==="passed"&&(i.value=!0,g({is_complete:i.value,scorm_content:""})):e==="cmi.suspend_data"&&!i.value&&G({is_complete:!1,scorm_content:t})},g=(e=null)=>{J("wg_lms.lms.doctype.course_lesson.course_lesson.save_progress",{lesson:s.doc.lessons[0].lesson,course:o.courseName,scorm_details:e})},u=F({url:"frappe.client.get_value",makeParams(e){var t,a;return{doctype:"LMS Course Progress",fieldname:["status","scorm_content"],filters:{member:(t=c.data)==null?void 0:t.name,lesson:s.doc.lessons[0].lesson,chapter:s.doc.name,course:(a=s.doc)==null?void 0:a.course}}},onSuccess(e){_.value=!0}}),$=()=>{var e;m.insert.submit({course:o.courseName,member:(e=c.data)==null?void 0:e.name},{onSuccess(t){window.location.reload()}})},P=()=>{window.API_1484_11={Initialize:()=>"true",Terminate:()=>"true",GetValue:e=>(console.log(`GET: ${e}`),S(e)),SetValue:(e,t)=>(console.log(`SET: ${e} to value: ${t}`),h(e,t),"true"),Commit:()=>"true",GetLastError:()=>"0",GetErrorString:()=>"",GetDiagnostic:()=>""},window.API={LMSInitialize:()=>"true",LMSFinish:()=>"true",LMSGetValue:e=>(console.log(`GET: ${e}`),S(e)),LMSSetValue:(e,t)=>(console.log(`SET: ${e} to value: ${t}`),h(e,t),"true"),LMSCommit:()=>"true",LMSGetLastError:()=>"0",LMSGetErrorString:()=>"",LMSGetDiagnostic:()=>""}},y=q(()=>{var e,t;return[{label:"Courses",route:{name:"Courses"}},{label:(e=s.doc)==null?void 0:e.course_title,route:{name:"CourseDetail",params:{courseName:o.courseName}}},{label:(t=s.doc)==null?void 0:t.title}]});return z(()=>{var e;return{title:(e=s.doc)==null?void 0:e.title,icon:T.favicon}}),(e,t)=>{var a,n,C,L;return p(),d(k,null,[l("header",Q,[N(r(K),{class:"h-7",items:y.value},null,8,["items"])]),_.value&&((a=r(m).data)!=null&&a.length||(n=r(c).data)!=null&&n.is_moderator||(C=r(c).data)!=null&&C.is_instructor)?(p(),d("div",U,[l("iframe",{src:r(s).doc.launch_file,class:"w-full h-[calc(100vh-3.00rem)]"},null,8,W)])):(L=r(m).data)!=null&&L.length?j("",!0):(p(),d("div",X,[l("div",Z,[l("div",ee,[l("div",te,w(e.__("You are not enrolled in this course. Please enroll to access this lesson.")),1),N(r(Y),{variant:"solid",onClick:t[0]||(t[0]=se=>$())},{default:O(()=>[H(w(e.__("Start Learning")),1)]),_:1})])])]))],64)}}};export{re as default};
//# sourceMappingURL=SCORMChapter-C13Lwjut.js.map
