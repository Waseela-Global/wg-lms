import{y as S,b7 as y,d as A,b8 as H,B as E,b9 as V,ba as h,ar as $,bb as D,bc as ae,bd as le,be as T,bf as q,bg as se,bh as K,bi as W,z as ne,b2 as oe,bj as re,bk as ue,bl as ie,bm as ce,bn as de,bo as me,bp as ve,bq as fe,i as F,br as pe,bs as be,s as ge,v as z,aa as _e,c as O,J,h as L,o as M,w,e as g,a as C,b as R,f as I,t as x,u as i,N as he,L as ye,F as Y,g as Z,n as X,k as U,D as ke,a8 as Ie,aS as xe,l as j,q as N,bt as Me,bu as Se,bv as De,C as we,j as Ce,G as Ee,bw as $e,ab as Pe,A as Re}from"./index-CZIp1LU6.js";import{s as Te}from"./use-resolve-button-type-Bt-hu_zP.js";let G=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function Q(a){var m,u;let c=(m=a.innerText)!=null?m:"",v=a.cloneNode(!0);if(!(v instanceof HTMLElement))return c;let o=!1;for(let f of v.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))f.remove(),o=!0;let e=o?(u=v.innerText)!=null?u:"":c;return G.test(e)&&(e=e.replace(G,"")),e}function Fe(a){let m=a.getAttribute("aria-label");if(typeof m=="string")return m.trim();let u=a.getAttribute("aria-labelledby");if(u){let c=u.split(" ").map(v=>{let o=document.getElementById(v);if(o){let e=o.getAttribute("aria-label");return typeof e=="string"?e.trim():Q(o).trim()}return null}).filter(Boolean);if(c.length>0)return c.join(", ")}return Q(a).trim()}function Ae(a){let m=S(""),u=S("");return()=>{let c=y(a);if(!c)return"";let v=c.innerText;if(m.value===v)return u.value;let o=Fe(c).trim().toLowerCase();return m.value=v,u.value=o,o}}var Ve=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(Ve||{}),Be=(a=>(a[a.Pointer=0]="Pointer",a[a.Other=1]="Other",a))(Be||{});function je(a){requestAnimationFrame(()=>requestAnimationFrame(a))}let ee=Symbol("MenuContext");function B(a){let m=F(ee,null);if(m===null){let u=new Error(`<${a} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(u,B),u}return m}let Ne=A({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(a,{slots:m,attrs:u}){let c=S(1),v=S(null),o=S(null),e=S([]),f=S(""),p=S(null),k=S(1);function _(t=l=>l){let l=p.value!==null?e.value[p.value]:null,s=pe(t(e.value.slice()),d=>y(d.dataRef.domRef)),r=l?s.indexOf(l):null;return r===-1&&(r=null),{items:s,activeItemIndex:r}}let n={menuState:c,buttonRef:v,itemsRef:o,items:e,searchQuery:f,activeItemIndex:p,activationTrigger:k,closeMenu:()=>{c.value=1,p.value=null},openMenu:()=>c.value=0,goToItem(t,l,s){let r=_(),d=fe(t===D.Specific?{focus:D.Specific,id:l}:{focus:t},{resolveItems:()=>r.items,resolveActiveIndex:()=>r.activeItemIndex,resolveId:b=>b.id,resolveDisabled:b=>b.dataRef.disabled});f.value="",p.value=d,k.value=s??1,e.value=r.items},search(t){let l=f.value!==""?0:1;f.value+=t.toLowerCase();let s=(p.value!==null?e.value.slice(p.value+l).concat(e.value.slice(0,p.value+l)):e.value).find(d=>d.dataRef.textValue.startsWith(f.value)&&!d.dataRef.disabled),r=s?e.value.indexOf(s):-1;r===-1||r===p.value||(p.value=r,k.value=1)},clearSearch(){f.value=""},registerItem(t,l){let s=_(r=>[...r,{id:t,dataRef:l}]);e.value=s.items,p.value=s.activeItemIndex,k.value=1},unregisterItem(t){let l=_(s=>{let r=s.findIndex(d=>d.id===t);return r!==-1&&s.splice(r,1),s});e.value=l.items,p.value=l.activeItemIndex,k.value=1}};return ie([v,o],(t,l)=>{var s;n.closeMenu(),ce(l,de.Loose)||(t.preventDefault(),(s=y(v))==null||s.focus())},E(()=>c.value===0)),be(ee,n),me(E(()=>ve(c.value,{0:T.Open,1:T.Closed}))),()=>{let t={open:c.value===0,close:n.closeMenu};return V({ourProps:{},theirProps:a,slot:t,slots:m,attrs:u,name:"Menu"})}}}),Oe=A({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"},id:{type:String,default:null}},setup(a,{attrs:m,slots:u,expose:c}){var v;let o=(v=a.id)!=null?v:`headlessui-menu-button-${H()}`,e=B("MenuButton");c({el:e.buttonRef,$el:e.buttonRef});function f(n){switch(n.key){case h.Space:case h.Enter:case h.ArrowDown:n.preventDefault(),n.stopPropagation(),e.openMenu(),$(()=>{var t;(t=y(e.itemsRef))==null||t.focus({preventScroll:!0}),e.goToItem(D.First)});break;case h.ArrowUp:n.preventDefault(),n.stopPropagation(),e.openMenu(),$(()=>{var t;(t=y(e.itemsRef))==null||t.focus({preventScroll:!0}),e.goToItem(D.Last)});break}}function p(n){switch(n.key){case h.Space:n.preventDefault();break}}function k(n){a.disabled||(e.menuState.value===0?(e.closeMenu(),$(()=>{var t;return(t=y(e.buttonRef))==null?void 0:t.focus({preventScroll:!0})})):(n.preventDefault(),e.openMenu(),je(()=>{var t;return(t=y(e.itemsRef))==null?void 0:t.focus({preventScroll:!0})})))}let _=Te(E(()=>({as:a.as,type:m.type})),e.buttonRef);return()=>{var n;let t={open:e.menuState.value===0},{...l}=a,s={ref:e.buttonRef,id:o,type:_.value,"aria-haspopup":"menu","aria-controls":(n=y(e.itemsRef))==null?void 0:n.id,"aria-expanded":e.menuState.value===0,onKeydown:f,onKeyup:p,onClick:k};return V({ourProps:s,theirProps:l,slot:t,attrs:m,slots:u,name:"MenuButton"})}}}),Le=A({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(a,{attrs:m,slots:u,expose:c}){var v;let o=(v=a.id)!=null?v:`headlessui-menu-items-${H()}`,e=B("MenuItems"),f=S(null);c({el:e.itemsRef,$el:e.itemsRef}),ae({container:E(()=>y(e.itemsRef)),enabled:E(()=>e.menuState.value===0),accept(t){return t.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:t.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(t){t.setAttribute("role","none")}});function p(t){var l;switch(f.value&&clearTimeout(f.value),t.key){case h.Space:if(e.searchQuery.value!=="")return t.preventDefault(),t.stopPropagation(),e.search(t.key);case h.Enter:if(t.preventDefault(),t.stopPropagation(),e.activeItemIndex.value!==null){let s=e.items.value[e.activeItemIndex.value];(l=y(s.dataRef.domRef))==null||l.click()}e.closeMenu(),W(y(e.buttonRef));break;case h.ArrowDown:return t.preventDefault(),t.stopPropagation(),e.goToItem(D.Next);case h.ArrowUp:return t.preventDefault(),t.stopPropagation(),e.goToItem(D.Previous);case h.Home:case h.PageUp:return t.preventDefault(),t.stopPropagation(),e.goToItem(D.First);case h.End:case h.PageDown:return t.preventDefault(),t.stopPropagation(),e.goToItem(D.Last);case h.Escape:t.preventDefault(),t.stopPropagation(),e.closeMenu(),$(()=>{var s;return(s=y(e.buttonRef))==null?void 0:s.focus({preventScroll:!0})});break;case h.Tab:t.preventDefault(),t.stopPropagation(),e.closeMenu(),$(()=>se(y(e.buttonRef),t.shiftKey?K.Previous:K.Next));break;default:t.key.length===1&&(e.search(t.key),f.value=setTimeout(()=>e.clearSearch(),350));break}}function k(t){switch(t.key){case h.Space:t.preventDefault();break}}let _=le(),n=E(()=>_!==null?(_.value&T.Open)===T.Open:e.menuState.value===0);return()=>{var t,l;let s={open:e.menuState.value===0},{...r}=a,d={"aria-activedescendant":e.activeItemIndex.value===null||(t=e.items.value[e.activeItemIndex.value])==null?void 0:t.id,"aria-labelledby":(l=y(e.buttonRef))==null?void 0:l.id,id:o,onKeydown:p,onKeyup:k,role:"menu",tabIndex:0,ref:e.itemsRef};return V({ourProps:d,theirProps:r,slot:s,attrs:m,slots:u,features:q.RenderStrategy|q.Static,visible:n.value,name:"MenuItems"})}}}),Ye=A({name:"MenuItem",inheritAttrs:!1,props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1},id:{type:String,default:null}},setup(a,{slots:m,attrs:u,expose:c}){var v;let o=(v=a.id)!=null?v:`headlessui-menu-item-${H()}`,e=B("MenuItem"),f=S(null);c({el:f,$el:f});let p=E(()=>e.activeItemIndex.value!==null?e.items.value[e.activeItemIndex.value].id===o:!1),k=Ae(f),_=E(()=>({disabled:a.disabled,get textValue(){return k()},domRef:f}));ne(()=>e.registerItem(o,_)),oe(()=>e.unregisterItem(o)),re(()=>{e.menuState.value===0&&p.value&&e.activationTrigger.value!==0&&$(()=>{var b,P;return(P=(b=y(f))==null?void 0:b.scrollIntoView)==null?void 0:P.call(b,{block:"nearest"})})});function n(b){if(a.disabled)return b.preventDefault();e.closeMenu(),W(y(e.buttonRef))}function t(){if(a.disabled)return e.goToItem(D.Nothing);e.goToItem(D.Specific,o)}let l=ue();function s(b){l.update(b)}function r(b){l.wasMoved(b)&&(a.disabled||p.value||e.goToItem(D.Specific,o,0))}function d(b){l.wasMoved(b)&&(a.disabled||p.value&&e.goToItem(D.Nothing))}return()=>{let{disabled:b,...P}=a,te={active:p.value,disabled:b,close:e.closeMenu};return V({ourProps:{id:o,ref:f,role:"menuitem",tabIndex:b===!0?void 0:-1,"aria-disabled":b===!0?!0:void 0,onClick:n,onFocus:t,onPointerenter:s,onMouseenter:s,onPointermove:r,onMousemove:r,onPointerleave:d,onMouseleave:d},theirProps:{...u,...P},slot:te,attrs:u,slots:m,name:"MenuItem"})}}});const Ue={class:"flex flex-col gap-4"},He={class:"mb-1.5 text-sm text-ink-gray-5"},qe={class:"mb-1.5 text-sm text-ink-gray-5"},Ke={key:0},ze={class:"mb-1.5 text-sm text-ink-gray-5"},Je={class:"grid grid-cols-2 gap-2"},Ge=["onClick"],Qe={key:1,class:"text-sm italic text-ink-red-4"},We={__name:"EvaluationModal",props:ge({courses:{type:Array,default:[]},batch:{type:String,default:null},endDate:{type:String,default:null}},{modelValue:{},modelModifiers:{},reloadEvals:{},reloadEvalsModifiers:{}}),emits:["update:modelValue","update:reloadEvals"],setup(a){const m=F("$user"),u=F("$dayjs"),c=z(a,"modelValue"),v=z(a,"reloadEvals"),o=a,e=_e({course:"",date:"",start_time:"",end_time:"",day:"",batch:o.batch,member:m.data.name}),f=O({url:"frappe.client.insert",makeParams(t){return{doc:{doctype:"LMS Certificate Request",batch_name:t.batch,...t}}}});function p(t){f.submit(e,{validate(){if(!e.course)return"Please select a course.";if(!e.date)return"Please select a date.";if(!e.start_time)return"Please select a slot.";if(u(e.date).isBefore(u(),"day"))return"Please select a future date.";if(u(e.date).isAfter(u(o.endDate),"day"))return`Please select a date before the end date ${u(o.endDate).format("DD MMMM YYYY")}.`},onSuccess(){v.value.reload(),t()},onError(l){var s;Ie.warning(__(((s=l.messages)==null?void 0:s[0])||l))}})}const k=()=>{const t=[];for(const l of o.courses)l.evaluator&&t.push({label:l.title,value:l.course});return t.length===1&&(e.course=t[0].value),t},_=O({url:"wg_lms.lms.doctype.course_evaluator.course_evaluator.get_schedule",makeParams(t){return{course:t.course,date:t.date,batch:o.batch}}});J(()=>e.date,t=>{e.start_time="",t&&e.course&&_.submit(e)}),J(()=>e.course,t=>{e.date="",e.start_time="",_.reset()});const n=t=>{e.start_time=t.start_time,e.end_time=t.end_time,e.day=t.day};return(t,l)=>(M(),L(i(ke),{modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=s=>c.value=s),options:{title:t.__("Schedule Evaluation"),size:"xl",actions:[{label:t.__("Submit"),variant:"solid",onClick:s=>p(s)}]}},{"body-content":w(()=>{var s;return[g("div",Ue,[g("div",null,[g("div",He,x(t.__("Course")),1),I(i(he),{modelValue:e.course,"onUpdate:modelValue":l[0]||(l[0]=r=>e.course=r),options:k()},null,8,["modelValue","options"])]),g("div",null,[g("div",qe,x(t.__("Date")),1),I(i(ye),{type:"date",modelValue:e.date,"onUpdate:modelValue":l[1]||(l[1]=r=>e.date=r),min:i(u)().add(i(u).duration({days:1})).format("YYYY-MM-DD")},null,8,["modelValue","min"])]),(s=i(_).data)!=null&&s.length?(M(),C("div",Ke,[g("div",ze,x(t.__("Select a slot")),1),g("div",Je,[(M(!0),C(Y,null,Z(i(_).data,r=>(M(),C("div",null,[g("div",{class:X(["text-base text-center border rounded-md text-ink-gray-8 bg-surface-gray-3 p-2 cursor-pointer",{"border-outline-gray-4":e.start_time==r.start_time}]),onClick:d=>n(r)},x(i(U)(r.start_time))+" - "+x(i(U)(r.end_time)),11,Ge)]))),256))])])):e.course&&e.date?(M(),C("div",Qe,x(t.__("No slots available for this date.")),1)):R("",!0)])]}),_:1},8,["modelValue","options"]))}},Ze={key:0},Xe={class:"flex items-center justify-between mb-4"},et={class:"text-lg text-ink-gray-9 font-semibold"},tt={key:0},at={class:"border text-ink-gray-7 rounded-md p-3"},lt={class:"flex justify-between mb-3"},st={class:"text-lg font-semibold text-ink-gray-9 leading-5"},nt={class:"flex items-center mb-2"},ot={class:"ml-2"},rt={class:"flex items-center mb-2"},ut={class:"ml-2"},it={class:"flex items-center"},ct={class:"ml-2"},dt={key:0,class:"flex items-center justify-between space-x-2 mt-4"},mt={key:1,class:"text-ink-gray-5"},pt={__name:"UpcomingEvaluations",props:{batch:{type:String,default:null},courses:{type:Array,default:[]},endDate:{type:String,default:null},forHome:{type:Boolean,default:!1}},setup(a){const m=F("$dayjs"),u=S(!1),c=xe(),{$dialog:v}=c.appContext.config.globalProperties,o=a,e=O({url:"wg_lms.lms.utils.get_upcoming_evals",params:{courses:o.courses.map(n=>n.course),batch:o.batch},auto:!0});function f(){u.value=!0}const p=n=>{window.open(n.google_meet_link,"_blank")},k=E(()=>o.courses.filter(n=>n.evaluator!="")),_=n=>{v({title:__("Cancel this evaluation?"),message:__("Are you sure you want to cancel this evaluation? This action cannot be undone."),actions:[{label:__("Cancel"),theme:"red",variant:"solid",onClick(t){Re("wg_lms.lms.api.cancel_evaluation",{evaluation:n}).then(()=>{e.reload()}),t()}}]})};return(n,t)=>{var l,s,r;return M(),C(Y,null,[!a.forHome||a.forHome&&((l=i(e).data)!=null&&l.length)?(M(),C("div",Ze,[g("div",Xe,[g("div",et,x(n.__("Upcoming Evaluations")),1),((s=i(e).data)==null?void 0:s.length)!=k.value.length&&!a.forHome?(M(),L(i(N),{key:0,onClick:f},{default:w(()=>[j(x(n.__("Schedule Evaluation")),1)]),_:1})):R("",!0)]),(r=i(e).data)!=null&&r.length?(M(),C("div",tt,[g("div",{class:X(["grid gap-4",a.forHome?"grid-cols-2":"grid-cols-3"])},[(M(!0),C(Y,null,Z(i(e).data,d=>(M(),C("div",null,[g("div",at,[g("div",lt,[g("span",st,x(d.course_title),1),d.date>i(m)().format()?(M(),L(i(Ne),{key:0,as:"div",class:"relative inline-block text-left"},{default:w(()=>[g("div",null,[I(i(Oe),{class:"inline-flex w-full justify-center"},{default:w(()=>[I(i(Me),{class:"w-4 h-4 stroke-1.5"})]),_:1})]),I(Se,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:w(()=>[I(i(Le),{class:"absolute mt-2 w-32 rounded-md bg-surface-white border p-1.5"},{default:w(()=>[I(i(Ye),null,{default:w(({active:b})=>[I(i(N),{variant:"ghost",class:"w-full",onClick:P=>_(d)},{prefix:w(()=>[I(i(De),{active:b,class:"size-4 stroke-1.5","aria-hidden":"true"},null,8,["active"])]),default:w(()=>[j(" "+x(n.__("Cancel")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):R("",!0)]),g("div",nt,[I(i(we),{class:"w-4 h-4 stroke-1.5"}),g("span",ot,x(i(m)(d.date).format("DD MMMM YYYY")),1)]),g("div",rt,[I(i(Ce),{class:"w-4 h-4 stroke-1.5"}),g("span",ut,x(i(U)(d.start_time)),1)]),g("div",it,[I(i(Ee),{class:"w-4 h-4 stroke-1.5"}),g("span",ct,x(d.evaluator_name),1)]),d.google_meet_link?(M(),C("div",dt,[I(i(N),{onClick:b=>p(d),class:"w-full"},{prefix:w(()=>[I(i($e),{class:"w-4 h-4 stroke-1.5"})]),default:w(()=>[j(" "+x(n.__("Join Call")),1)]),_:1},8,["onClick"])])):R("",!0)])]))),256))],2)])):(M(),C("div",mt,x(n.__("Schedule an evaluation to get certified.")),1))])):R("",!0),I(We,{batch:a.batch,endDate:a.endDate,courses:a.courses,modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=d=>u.value=d),reloadEvals:i(e),"onUpdate:reloadEvals":t[1]||(t[1]=d=>Pe(e)?e.value=d:null)},null,8,["batch","endDate","courses","modelValue","reloadEvals"])],64)}}};export{pt as _};
//# sourceMappingURL=UpcomingEvaluations-CqwW5TBi.js.map
