import{d as me,B as J,a as h,o as u,e as a,f as r,t as n,u as t,bH as pe,w as f,F as X,g as Y,ak as R,Z as B,L as d,q as E,bA as Z,h as k,b as y,cz as _e,i as fe,y as z,x as ge,p as be,aL as ve,aS as ye,aa as j,z as Ce,a9 as K,c as $,cA as Ve,aq as ke,a8 as N,cB as G,J as he,E as we,am as xe,aM as T,aI as q,cC as Ue,n as Se,l as P,cD as $e,cE as Ne,by as Ee,ai as Pe}from"./index-CZIp1LU6.js";import{_ as Me}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-B2fdcvTt.js";import{_ as ze}from"./CourseOutline-DhBrYICy.js";import{_ as H}from"./MultiSelect-BuakTAWM.js";import"./vuedraggable.umd-YwMGlx1c.js";import"./use-resolve-button-type-Bt-hu_zP.js";const Te={class:"text-xs text-ink-gray-5 mb-1"},qe={class:"space-y-2"},Ie={class:"rounded-lg bg-surface-white p-3 border w-fit mt-2"},Le={class:"text-xs text-ink-gray-5 mb-1.5"},Fe={class:"grid grid-cols-7 gap-2"},De=["onClick"],Ae={class:"text-sm text-ink-gray-5 mt-2"},Oe=me({__name:"ColorSwatches",props:{modelValue:{},label:{},description:{}},emits:["update:modelValue","change"],setup(C,{emit:V}){const c=V,M=J(()=>["Red","Blue","Green","Amber","Purple","Cyan","Orange","Violet","Pink","Teal","Gray","Yellow"]);return(g,m)=>(u(),h("div",null,[a("div",Te,n(g.__(C.label)),1),r(t(pe),{placement:"bottom",class:"!block"},{target:f(({togglePopover:_,isOpen:w})=>[a("div",qe,[r(t(d),{type:"text",autocomplete:"off",class:"w-full",placeholder:g.__("Set Color"),onFocus:_,modelValue:C.modelValue,"onUpdate:modelValue":m[1]||(m[1]=U=>c("update:modelValue",U))},{prefix:f(()=>[a("div",{class:"size-4 rounded-full",style:R(C.modelValue?{backgroundColor:t(B).backgroundColor[C.modelValue.toLowerCase()][400]}:{})},[C.modelValue?y("",!0):(u(),k(t(_e),{key:0,class:"size-4 stroke-1.5 text-ink-gray-5"}))],4)]),suffix:f(()=>[r(t(E),{variant:"ghost"},{default:f(()=>[r(t(Z),{class:"size-3 text-ink-gray-5",onClick:m[0]||(m[0]=U=>c("update:modelValue",null))})]),_:1})]),_:1},8,["placeholder","onFocus","modelValue"])])]),body:f(({close:_})=>[a("div",Ie,[a("div",Le,n(g.__("Swatches")),1),a("div",Fe,[(u(!0),h(X,null,Y(M.value,w=>(u(),h("div",{key:w,class:"size-5 rounded-full cursor-pointer",style:R({backgroundColor:t(B).backgroundColor[w.toLowerCase()][400]}),onClick:U=>{c("update:modelValue",w),_(),c("change",w)}},null,12,De))),128))])])]),_:1}),a("div",Ae,n(C.description),1)]))}}),Re={class:"h-full"},Be={class:"grid grid-cols-1 md:grid-cols-[70%,30%] h-full"},je={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ke={class:"flex items-center mt-3 md:mt-0"},Ge={class:"mt-5 mb-5"},He={class:"px-5 md:px-10 pb-5 mb-5 space-y-5 border-b"},Je={class:"text-lg font-semibold mb-4 text-ink-gray-9"},Xe={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},Ze={class:"text-xs text-ink-gray-5"},Qe={class:"flex items-center flex-wrap gap-2"},We={class:"flex items-center bg-surface-gray-2 text-ink-gray-7 p-2 rounded-md"},es={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},ss={class:"mb-4"},ls={class:"text-xs text-ink-gray-5 mb-2"},os={class:"flex items-center"},as=["onClick"],ts={class:"ml-4"},rs={class:"mt-1 text-ink-gray-5 text-sm leading-5"},is={key:1,class:"mb-4"},ds={class:"flex items-center"},ns=["src"],us={class:"ml-4"},cs={class:"mt-2 text-ink-gray-5 text-sm"},ms={class:"px-5 md:px-10 pb-5 mb-5 space-y-5 border-b"},ps={class:"text-lg font-semibold text-ink-gray-9"},_s={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},fs={key:0,class:"flex flex-col space-y-5"},gs={class:"flex flex-col space-y-5"},bs={class:"px-5 md:px-10 pb-5 mb-5 space-y-5 border-b"},vs={class:"text-lg font-semibold text-ink-gray-9"},ys={class:""},Cs={class:"mb-1.5 text-sm text-ink-gray-5"},Vs={class:"px-5 md:px-10 pb-5 space-y-5 border-b"},ks={class:"text-lg font-semibold mt-5 text-ink-gray-9"},hs={class:"grid grid-cols-1 md:grid-cols-3 gap-5"},ws={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},xs={class:"space-y-5"},Us={class:"space-y-5"},Ss={class:"px-5 md:px-10 pb-5 space-y-5"},$s={class:"text-lg font-semibold mt-5 text-ink-gray-9"},Ns={class:"space-y-5"},Es={class:"border-l"},Fs={__name:"CourseForm",props:{courseName:{type:String}},setup(C){const V=fe("$user"),c=z(""),{brand:M}=ge(),g=be(),m=z([]),_=z([]),w=ye(),{updateOnboardingStep:U}=ve("learning"),{$dialog:Q}=w.appContext.config.globalProperties,b=C,l=j({title:"",short_introduction:"",description:"",video_link:"",course_image:null,card_gradient:"",tags:"",category:"",published:!1,published_on:"",featured:!1,upcoming:!1,disable_self_learning:!1,enable_certification:!1,paid_course:!1,paid_certificate:!1,course_price:"",currency:"",evaluator:"",timezone:""}),x=j({description:"",keywords:""});Ce(()=>{var e,s;!((e=V.data)!=null&&e.is_moderator)&&!((s=V.data)!=null&&s.is_instructor)&&g.push({name:"Courses"}),b.courseName!=="new"?I():K("course_form_opened"),window.addEventListener("keydown",L)});const I=()=>{v.reload(),Ve("courses",b.courseName,x)},L=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(F(),e.preventDefault())};ke(()=>{window.removeEventListener("keydown",L)});const W=$({url:"frappe.client.insert",makeParams(e){var s;return{doc:{doctype:"LMS Course",image:((s=l.course_image)==null?void 0:s.file_url)||"",instructors:m.value.map(i=>({instructor:i})),related_courses:_.value.map(i=>({course:i})),...e}}}}),ee=$({url:"frappe.client.set_value",auto:!1,makeParams(e){var s;return{doctype:"LMS Course",name:e.course,fieldname:{image:((s=l.course_image)==null?void 0:s.file_url)||"",instructors:m.value.map(i=>({instructor:i})),related_courses:_.value.map(i=>({course:i})),...l}}}}),v=$({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Course",name:b.courseName}},auto:!1,onSuccess(e){Object.keys(e).forEach(i=>{i=="instructors"?(m.value=[],e.instructors.forEach(p=>{m.value.push(p.instructor)})):i=="related_courses"?(_.value=[],e.related_courses.forEach(p=>{_.value.push(p.course)})):Object.hasOwn(l,i)&&(l[i]=e[i])});let s=["published","upcoming","disable_self_learning","paid_course","featured","enable_certification","paid_certificate"];for(let i in s){let p=s[i];l[p]=!!l[p]}e.image&&se.reload({image:e.image}),ue()}}),se=$({url:"wg_lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.course_image=e}}),F=()=>{v.data?oe():le()},le=()=>{W.submit(l,{onSuccess(e){var s;G("courses",e.name,x),(s=V.data)!=null&&s.is_system_manager&&U("create_first_course",!0,!1,()=>{localStorage.setItem("firstCourse",e.name)}),K("course_created"),N.success(__("Course created successfully")),g.push({name:"CourseForm",params:{courseName:e.name}})},onError(e){var s;N.error(((s=e.messages)==null?void 0:s[0])||e)}})},oe=()=>{ee.submit({course:v.data.name},{onSuccess(){G("courses",b.courseName,x),N.success(__("Course updated successfully"))},onError(e){var s;N.error(((s=e.messages)==null?void 0:s[0])||e)}})},ae=$({url:"wg_lms.lms.api.delete_course",makeParams(e){return{course:b.courseName}},onSuccess(){N.success(__("Course deleted successfully")),g.push({name:"Courses"})}}),te=()=>{Q({title:__("Delete Course"),message:__("Deleting the course will also delete all its chapters and lessons. Are you sure you want to delete this course?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(e){ae.submit(),e()}}]})};he(()=>b.courseName!=="new",e=>{e&&I()});const re=()=>{c.value&&(l.tags=l.tags?`${l.tags}, ${c.value}`:c.value,c.value="")},ie=e=>{var s;l.tags=(s=l.tags)==null?void 0:s.split(", ").filter(i=>i!==e).join(", "),c.value=""},de=e=>{l.course_image=e},ne=()=>{l.course_image=null},ue=()=>{var s;let e=!1;(s=V.data)!=null&&s.is_moderator||(m.value.forEach(i=>{var p;!e&&i==((p=V.data)==null?void 0:p.name)&&(e=!0)}),e||g.push({name:"Courses"}))},ce=J(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return v.data&&e.push({label:l.title,route:{name:"CourseDetail",params:{courseName:b.courseName}}}),e.push({label:b.courseName=="new"?"New Course":"Edit Course",route:{name:"CourseForm",params:{courseName:b.courseName}}}),e});return we(()=>{var e;return{title:((e=v.data)==null?void 0:e.title)||__("New Course"),icon:M.favicon}}),(e,s)=>{var i,p,D,A;return u(),h("div",Re,[a("div",Be,[a("div",null,[a("header",je,[r(t(Me),{class:"h-7",items:ce.value},null,8,["items"]),a("div",Ke,[(i=t(v).data)!=null&&i.name?(u(),k(t(E),{key:0,onClick:s[0]||(s[0]=o=>te())},{icon:f(()=>[r(t(xe),{class:"w-4 h-4 stroke-1.5"})]),_:1})):y("",!0),r(t(E),{variant:"solid",onClick:s[1]||(s[1]=o=>F()),class:"ml-2"},{default:f(()=>[a("span",null,n(e.__("Save")),1)]),_:1})])]),a("div",Ge,[a("div",He,[a("div",Je,n(e.__("Details")),1),a("div",Xe,[r(t(d),{modelValue:l.title,"onUpdate:modelValue":s[2]||(s[2]=o=>l.title=o),label:e.__("Title"),required:!0},null,8,["modelValue","label"]),r(q,{doctype:"LMS Category",modelValue:l.category,"onUpdate:modelValue":s[3]||(s[3]=o=>l.category=o),label:e.__("Category"),onCreate:(o,S)=>t(T)("Categories",S)},null,8,["modelValue","label","onCreate"])]),a("div",Ye,[r(H,{modelValue:m.value,"onUpdate:modelValue":s[4]||(s[4]=o=>m.value=o),doctype:"User",label:e.__("Instructors"),filters:{ignore_user_type:1},onCreate:o=>t(T)("Members",o),required:!0},null,8,["modelValue","label","onCreate"]),a("div",null,[a("div",Ze,n(e.__("Tags")),1),r(t(d),{modelValue:c.value,"onUpdate:modelValue":s[5]||(s[5]=o=>c.value=o),placeholder:e.__("Add a keyword and then press enter"),class:Se(["w-full","flex-1","my-1"]),onKeyup:s[6]||(s[6]=Ue(o=>re(),["enter"])),id:"tags"},null,8,["modelValue","placeholder"]),a("div",null,[a("div",Qe,[l.tags?(u(!0),h(X,{key:0},Y((p=l.tags)==null?void 0:p.split(", "),o=>(u(),h("div",We,[P(n(o)+" ",1),r(t(Z),{class:"stroke-1.5 w-3 h-3 ml-2 cursor-pointer",onClick:S=>ie(o)},null,8,["onClick"])]))),256)):y("",!0)])])])]),a("div",es,[a("div",ss,[a("div",ls,n(e.__("Course Image")),1),l.course_image?(u(),h("div",is,[a("div",ds,[a("img",{src:l.course_image.file_url,class:"border rounded-md w-40"},null,8,ns),a("div",us,[r(t(E),{onClick:s[8]||(s[8]=o=>ne())},{default:f(()=>[P(n(e.__("Remove")),1)]),_:1}),a("div",cs,n(e.__("Appears on the course card in the course list")),1)])])])):(u(),k(t(Ee),{key:0,fileTypes:["image/*"],validateFile:t(Ne),onSuccess:s[7]||(s[7]=o=>de(o))},{default:f(({file:o,progress:S,uploading:Ps,openFileSelector:O})=>[a("div",os,[a("div",{class:"border rounded-md w-fit py-5 px-20 cursor-pointer",onClick:O},[r(t($e),{class:"size-5 stroke-1 text-ink-gray-7"})],8,as),a("div",ts,[r(t(E),{onClick:O},{default:f(()=>[P(n(e.__("Upload")),1)]),_:1},8,["onClick"]),a("div",rs,n(e.__("Appears on the course card in the course list")),1)])])]),_:1},8,["validateFile"]))]),r(Oe,{modelValue:l.card_gradient,"onUpdate:modelValue":s[9]||(s[9]=o=>l.card_gradient=o),label:e.__("Color"),description:e.__("Choose a color for the course card"),class:"w-full"},null,8,["modelValue","label","description"])])]),a("div",ms,[a("div",ps,n(e.__("Settings")),1),a("div",_s,[(D=t(V).data)!=null&&D.is_moderator?(u(),h("div",fs,[r(t(d),{type:"checkbox",modelValue:l.published,"onUpdate:modelValue":s[10]||(s[10]=o=>l.published=o),label:e.__("Published")},null,8,["modelValue","label"]),r(t(d),{modelValue:l.published_on,"onUpdate:modelValue":s[11]||(s[11]=o=>l.published_on=o),label:e.__("Published On"),type:"date"},null,8,["modelValue","label"])])):y("",!0),a("div",gs,[r(t(d),{type:"checkbox",modelValue:l.upcoming,"onUpdate:modelValue":s[12]||(s[12]=o=>l.upcoming=o),label:e.__("Upcoming")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.featured,"onUpdate:modelValue":s[13]||(s[13]=o=>l.featured=o),label:e.__("Featured")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.disable_self_learning,"onUpdate:modelValue":s[14]||(s[14]=o=>l.disable_self_learning=o),label:e.__("Disable Self Enrollment")},null,8,["modelValue","label"])])])]),a("div",bs,[a("div",vs,n(e.__("About the Course")),1),r(t(d),{modelValue:l.short_introduction,"onUpdate:modelValue":s[15]||(s[15]=o=>l.short_introduction=o),type:"textarea",rows:5,label:e.__("Short Introduction"),placeholder:e.__("A one line introduction to the course that appears on the course card"),required:!0},null,8,["modelValue","label","placeholder"]),a("div",ys,[a("div",Cs,[P(n(e.__("Course Description"))+" ",1),s[28]||(s[28]=a("span",{class:"text-ink-red-3"},"*",-1))]),r(t(Pe),{content:l.description,onChange:s[16]||(s[16]=o=>l.description=o),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r(t(d),{modelValue:l.video_link,"onUpdate:modelValue":s[17]||(s[17]=o=>l.video_link=o),label:e.__("Preview Video"),placeholder:e.__("Paste the youtube link of a short video introducing the course")},null,8,["modelValue","label","placeholder"]),r(H,{modelValue:_.value,"onUpdate:modelValue":s[18]||(s[18]=o=>_.value=o),doctype:"LMS Course",label:e.__("Related Courses"),filters:{name:["!=",(A=t(v).data)==null?void 0:A.name]},onCreate:o=>{t(g).push({name:"CourseForm",params:{courseName:"new"}})}},null,8,["modelValue","label","filters","onCreate"])]),a("div",Vs,[a("div",ks,n(e.__("Pricing and Certification")),1),a("div",hs,[r(t(d),{type:"checkbox",modelValue:l.paid_course,"onUpdate:modelValue":s[19]||(s[19]=o=>l.paid_course=o),label:e.__("Paid Course")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.enable_certification,"onUpdate:modelValue":s[20]||(s[20]=o=>l.enable_certification=o),label:e.__("Completion Certificate")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.paid_certificate,"onUpdate:modelValue":s[21]||(s[21]=o=>l.paid_certificate=o),label:e.__("Paid Certificate")},null,8,["modelValue","label"])]),a("div",ws,[a("div",xs,[l.paid_course||l.paid_certificate?(u(),k(t(d),{key:0,modelValue:l.course_price,"onUpdate:modelValue":s[22]||(s[22]=o=>l.course_price=o),label:e.__("Amount"),required:l.paid_course||l.paid_certificate},null,8,["modelValue","label","required"])):y("",!0),l.paid_certificate?(u(),k(q,{key:1,doctype:"Course Evaluator",modelValue:l.evaluator,"onUpdate:modelValue":s[23]||(s[23]=o=>l.evaluator=o),label:e.__("Evaluator"),required:l.paid_certificate,onCreate:(o,S)=>t(T)("Evaluators",S)},null,8,["modelValue","label","required","onCreate"])):y("",!0)]),a("div",Us,[l.paid_course||l.paid_certificate?(u(),k(q,{key:0,doctype:"Currency",modelValue:l.currency,"onUpdate:modelValue":s[24]||(s[24]=o=>l.currency=o),filters:{enabled:1},label:e.__("Currency"),required:l.paid_course||l.paid_certificate},null,8,["modelValue","label","required"])):y("",!0),l.paid_certificate?(u(),k(t(d),{key:1,modelValue:l.timezone,"onUpdate:modelValue":s[25]||(s[25]=o=>l.timezone=o),label:e.__("Timezone"),required:l.paid_certificate,placeholder:e.__("e.g. IST, UTC, GMT...")},null,8,["modelValue","label","required","placeholder"])):y("",!0)])])]),a("div",Ss,[a("div",$s,n(e.__("Meta Tags")),1),a("div",Ns,[r(t(d),{modelValue:x.description,"onUpdate:modelValue":s[26]||(s[26]=o=>x.description=o),label:e.__("Meta Description"),type:"textarea",rows:7},null,8,["modelValue","label"]),r(t(d),{modelValue:x.keywords,"onUpdate:modelValue":s[27]||(s[27]=o=>x.keywords=o),label:e.__("Meta Keywords"),type:"textarea",rows:7,placeholder:e.__("Comma separated keywords for SEO")},null,8,["modelValue","label","placeholder"])])])])]),a("div",Es,[t(v).data?(u(),k(ze,{key:0,courseName:t(v).data.name,title:e.__("Course Outline"),allowEdit:!0},null,8,["courseName","title"])):y("",!0)])])])}}};export{Fs as default};
//# sourceMappingURL=CourseForm-C2T7gVJB.js.map
