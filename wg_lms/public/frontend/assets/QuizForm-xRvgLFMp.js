import{s as W,v as F,y as E,i as K,aL as X,aa as B,c as h,J,h as q,o as r,w as c,e as m,a as p,b as k,t as y,f as d,u as e,aV as G,ai as Y,L as _,F as U,g as I,aI as Z,q as $,l as z,D as ee,a8 as g,x as se,p as te,z as le,aB as oe,aq as ae,B as H,E as ne,r as ie,a1 as ue,cP as de,cg as re,P as me,R as ce,S as _e,U as pe,W as be,X as fe,aK as ye,am as ke,Q as ve,ab as qe}from"./index-CZIp1LU6.js";import{_ as ge}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-B2fdcvTt.js";const Ve={class:"p-5 space-y-5"},we={class:"text-lg font-semibold text-ink-gray-9 mb-5"},he={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},$e={key:1},ze={class:"block text-xs text-ink-gray-5 mb-1"},Qe={class:"grid grid-cols-2 gap-8 mt-4"},xe={key:0,class:"text-base font-semibold text-ink-gray-9 mb-5 mt-10"},Se={key:1,class:"text-base font-semibold text-ink-gray-9 mb-5 mt-5"},Ue={key:2,class:"grid grid-cols-2 gap-x-8 gap-y-4"},De={class:"space-y-4 py-2"},Me={key:3,class:"grid grid-cols-2 gap-x-8 gap-y-4 py-2"},Ce={key:2,class:"space-y-2"},Le={class:"flex items-center justify-end space-x-2 mt-5"},Ee={__name:"Question",props:W({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},quiz:{},quizModifiers:{}}),emits:["update:modelValue","update:quiz"],setup(Q){const v=F(Q,"modelValue"),V=F(Q,"quiz"),b=E(!1),w=E(!1),P=K("$user"),{updateOnboardingStep:D}=X("learning"),f=B({question:"",marks:1}),u=B({question:"",type:"Choices",marks:1}),x=()=>{let a=["option","is_correct","explanation","possibility"],o=1;a.forEach(n=>{for(;o<=4;)u[`${n}_${o}`]=n==="is_correct"?!1:null,o++})};x();const t=Q,S=h({url:"frappe.client.get",makeParams(){return{doctype:"LMS Question",name:t.questionDetail.question}},auto:!1,onSuccess(a){let o=1;for(w.value=!0,Object.keys(a).forEach(n=>{Object.hasOwn(u,n)&&(u[n]=a[n])});o<=4;)u[`is_correct_${o}`]=!!a[`is_correct_${o}`],o++;u.marks=t.questionDetail.marks}});J(v,()=>{v.value&&(w.value=!1,t.questionDetail.question?S.fetch():(u.question="",u.marks=1,u.type="Choices",f.question="",f.marks=1,b.value=!1,x()),t.questionDetail.marks&&(u.marks=t.questionDetail.marks))});const T=h({url:"frappe.client.insert",makeParams(a){return{doc:{doctype:"LMS Quiz Question",parent:V.value.doc.name,parentfield:"questions",parenttype:"LMS Quiz",...a}}}}),M=h({url:"frappe.client.insert",makeParams(a){return{doc:{doctype:"LMS Question",...u}}}}),C=()=>{var a;(a=t.questionDetail)!=null&&a.question?l():N()},N=()=>{b.value?L({question:f.question,marks:f.marks}):M.submit({},{onSuccess(a){L({question:a.name,marks:u.marks})},onError(a){var o;g.error(((o=a.messages)==null?void 0:o[0])||a)}})},L=a=>{T.submit({...a},{onSuccess(){var o;(o=P.data)!=null&&o.is_system_manager&&D("create_first_quiz"),v.value=!1,g.success(__("Question added successfully")),V.value.reload(),v.value=!1},onError(o){var n;g.error(((n=o.messages)==null?void 0:n[0])||o),v.value=!1}})},O=h({url:"frappe.client.set_value",auto:!1,makeParams(a){var o;return{doctype:"LMS Question",name:(o=S.data)==null?void 0:o.name,fieldname:{...u}}}}),s=h({url:"frappe.client.set_value",auto:!1,makeParams(a){return{doctype:"LMS Quiz Question",name:t.questionDetail.name,fieldname:{marks:u.marks}}}}),l=()=>{O.submit({},{onSuccess(){s.submit({},{onSuccess(){v.value=!1,g.success(__("Question updated successfully")),V.value.reload()}})},onError(a){var o;g.error(((o=a.messages)==null?void 0:o[0])||a)}})};return(a,o)=>(r(),q(e(ee),{modelValue:v.value,"onUpdate:modelValue":o[7]||(o[7]=n=>v.value=n),options:{size:"5xl"}},{body:c(()=>[m("div",Ve,[m("div",we,y(a.__(t.title)),1),w.value?k("",!0):(r(),p("div",he,[d(e(G),{size:"sm",label:a.__("Choose an existing question"),modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=n=>b.value=n),class:"!p-0"},null,8,["label","modelValue"])])),!b.value||w.value?(r(),p("div",$e,[m("div",null,[m("label",ze,y(a.__("Question")),1),d(e(Y),{content:u.question,onChange:o[1]||(o[1]=n=>u.question=n),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),m("div",Qe,[d(e(_),{modelValue:u.marks,"onUpdate:modelValue":o[2]||(o[2]=n=>u.marks=n),label:a.__("Marks"),type:"number"},null,8,["modelValue","label"]),d(e(_),{label:a.__("Type"),modelValue:u.type,"onUpdate:modelValue":o[3]||(o[3]=n=>u.type=n),type:"select",options:["Choices","User Input","Open Ended"],class:"pb-2",required:!0},null,8,["label","modelValue"])]),u.type=="Choices"?(r(),p("div",xe,y(a.__("Options")),1)):u.type=="User Input"?(r(),p("div",Se,y(a.__("Possibilities")),1)):k("",!0),u.type=="Choices"?(r(),p("div",Ue,[(r(),p(U,null,I(4,n=>m("div",De,[d(e(_),{label:a.__("Option")+" "+n,modelValue:u[`option_${n}`],"onUpdate:modelValue":i=>u[`option_${n}`]=i,required:n<=2},null,8,["label","modelValue","onUpdate:modelValue","required"]),d(e(_),{label:a.__("Explanation"),modelValue:u[`explanation_${n}`],"onUpdate:modelValue":i=>u[`explanation_${n}`]=i},null,8,["label","modelValue","onUpdate:modelValue"]),d(e(_),{label:a.__("Correct Answer"),modelValue:u[`is_correct_${n}`],"onUpdate:modelValue":i=>u[`is_correct_${n}`]=i,type:"checkbox"},null,8,["label","modelValue","onUpdate:modelValue"])])),64))])):u.type=="User Input"?(r(),p("div",Me,[(r(),p(U,null,I(4,n=>m("div",null,[d(e(_),{label:a.__("Possibility")+" "+n,modelValue:u[`possibility_${n}`],"onUpdate:modelValue":i=>u[`possibility_${n}`]=i,required:n==1},null,8,["label","modelValue","onUpdate:modelValue","required"])])),64))])):k("",!0)])):b.value?(r(),p("div",Ce,[d(Z,{modelValue:f.question,"onUpdate:modelValue":o[4]||(o[4]=n=>f.question=n),label:a.__("Select a question"),doctype:"LMS Question"},null,8,["modelValue","label"]),d(e(_),{modelValue:f.marks,"onUpdate:modelValue":o[5]||(o[5]=n=>f.marks=n),label:a.__("Marks"),type:"number"},null,8,["modelValue","label"])])):k("",!0),m("div",Le,[d(e($),{variant:"solid",onClick:o[6]||(o[6]=n=>C())},{default:c(()=>[z(y(a.__("Save")),1)]),_:1})])])]),_:1},8,["modelValue"]))}},Ie={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Pe={key:0,class:"space-x-2"},Te={key:0,class:"py-5"},Ne={class:"px-20 pb-5 space-y-5 border-b mb-5"},Oe={class:"text-lg text-ink-gray-9 font-semibold mb-4"},Re={class:"grid grid-cols-2 gap-5"},je={class:"space-y-5"},Be={class:"space-y-5"},Ae={class:"px-20 pb-5 space-y-5 border-b mb-5"},Fe={class:"text-lg text-ink-gray-9 font-semibold mb-4"},He={class:"grid grid-cols-3 gap-5"},Ke={class:"flex flex-col space-y-10"},Je={class:"flex flex-col space-y-5"},We={class:"flex flex-col space-y-5"},Xe={class:"px-20 pb-5 space-y-5 mb-5"},Ge={class:"flex items-center justify-between mb-4"},Ye={class:"text-lg font-semibold text-ink-gray-9"},Ze=["innerHTML"],es={key:1,class:"text-xs"},ss={class:"flex gap-2"},ts={key:1,class:"text-ink-gray-6 text-sm"},as={__name:"QuizForm",props:{quizID:{type:String,required:!0}},setup(Q){const{brand:v}=se(),V=E(!1),b=B({question:"",marks:0,name:""}),w=K("$user"),P=te(),D=window.read_only_mode,f=Q,u=E([]);le(()=>{var s,l;!((s=w.data)!=null&&s.is_moderator)&&!((l=w.data)!=null&&l.is_instructor)&&P.push({name:"Courses"}),f.quizID!=="new"&&t.reload(),window.addEventListener("keydown",x)});const x=s=>{s.key==="s"&&(s.ctrlKey||s.metaKey)&&(S(),s.preventDefault())};ae(()=>{window.removeEventListener("keydown",x)}),J(()=>f.quizID!=="new",s=>{s&&t.reload()});const t=oe({doctype:"LMS Quiz",name:f.quizID,auto:!1,onSuccess(s){s.questions&&s.questions.length>0&&(u.value=s.questions.map(l=>l))}}),S=()=>{t.setValue.submit({...t.doc,total_marks:T()},{onSuccess(s){t.doc.total_marks=s.total_marks,g.success(__("Quiz updated successfully"))},onError(s){var l;g.error(((l=s.messages)==null?void 0:l[0])||s)}})},T=()=>{var l,a,o;let s=0;return(l=t.doc)!=null&&l.limit_questions_to&&((a=t.doc)==null?void 0:a.questions.length)>0?t.doc.questions[0].marks*t.doc.limit_questions_to:((o=t.doc)==null||o.questions.forEach(n=>{s+=n.marks}),s)},M=H(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Marks"),key:"marks",width:"5rem"}]),C=(s=null)=>{s?(b.question=s.question,b.marks=s.marks,b.name=s.name):(b.question="",b.marks=0,b.name=""),V.value=!0},N=h({url:"wg_lms.lms.api.delete_documents",makeParams(s){return{doctype:"LMS Quiz Question",documents:s.questions}}}),L=(s,l)=>{N.submit({questions:Array.from(s)},{onSuccess(){g.success(__("Questions deleted successfully")),t.reload(),l()}})},O=H(()=>{var l;let s=[{label:__("Quizzes"),route:{name:"Quizzes"}}];return s.push({label:f.quizID=="new"?__("New Quiz"):(l=t.doc)==null?void 0:l.title,route:{name:"QuizForm",params:{quizID:f.quizID}}}),s});return ne(()=>{var s;return{title:f.quizID=="new"?__("New Quiz"):(s=t.doc)==null?void 0:s.title,icon:v.favicon}}),(s,l)=>{var o,n;const a=ie("router-link");return r(),p(U,null,[m("header",Ie,[d(e(ge),{items:O.value},null,8,["items"]),e(D)?k("",!0):(r(),p("div",Pe,[e(t).isDirty?(r(),q(e(ue),{key:0,theme:"orange"},{default:c(()=>[z(y(s.__("Not Saved")),1)]),_:1})):k("",!0),(o=e(t).doc)!=null&&o.name?(r(),q(a,{key:1,to:{name:"QuizPage",params:{quizID:e(t).doc.name}}},{default:c(()=>[d(e($),null,{prefix:c(()=>[d(e(de),{class:"size-4 stroke-1.5"})]),default:c(()=>[z(" "+y(s.__("Test Quiz")),1)]),_:1})]),_:1},8,["to"])):k("",!0),(n=e(t).doc)!=null&&n.name?(r(),q(a,{key:2,to:{name:"QuizSubmissionList",params:{quizID:e(t).doc.name}}},{default:c(()=>[d(e($),null,{prefix:c(()=>[d(e(re),{class:"size-4 stroke-1.5"})]),default:c(()=>[z(" "+y(s.__("Check Submissions")),1)]),_:1})]),_:1},8,["to"])):k("",!0),d(e($),{variant:"solid",onClick:l[0]||(l[0]=i=>S())},{default:c(()=>[z(y(s.__("Save")),1)]),_:1})]))]),e(t).doc?(r(),p("div",Te,[m("div",Ne,[m("div",Oe,y(s.__("Details")),1),m("div",Re,[m("div",je,[d(e(_),{modelValue:e(t).doc.title,"onUpdate:modelValue":l[1]||(l[1]=i=>e(t).doc.title=i),label:s.__("Title"),required:!0},null,8,["modelValue","label"]),d(e(_),{type:"number",modelValue:e(t).doc.max_attempts,"onUpdate:modelValue":l[2]||(l[2]=i=>e(t).doc.max_attempts=i),label:s.__("Maximum Attempts")},null,8,["modelValue","label"]),d(e(_),{type:"number",modelValue:e(t).doc.duration,"onUpdate:modelValue":l[3]||(l[3]=i=>e(t).doc.duration=i),label:s.__("Duration (in minutes)")},null,8,["modelValue","label"])]),m("div",Be,[d(e(_),{modelValue:e(t).doc.total_marks,"onUpdate:modelValue":l[4]||(l[4]=i=>e(t).doc.total_marks=i),label:s.__("Total Marks"),disabled:""},null,8,["modelValue","label"]),d(e(_),{modelValue:e(t).doc.passing_percentage,"onUpdate:modelValue":l[5]||(l[5]=i=>e(t).doc.passing_percentage=i),label:s.__("Passing Percentage"),required:!0},null,8,["modelValue","label"])])])]),m("div",Ae,[m("div",Fe,y(s.__("Settings")),1),m("div",He,[m("div",Ke,[d(e(_),{modelValue:e(t).doc.show_answers,"onUpdate:modelValue":l[6]||(l[6]=i=>e(t).doc.show_answers=i),type:"checkbox",label:s.__("Show Answers")},null,8,["modelValue","label"]),d(e(_),{modelValue:e(t).doc.show_submission_history,"onUpdate:modelValue":l[7]||(l[7]=i=>e(t).doc.show_submission_history=i),type:"checkbox",label:s.__("Show Submission History")},null,8,["modelValue","label"])]),m("div",Je,[d(e(_),{modelValue:e(t).doc.shuffle_questions,"onUpdate:modelValue":l[8]||(l[8]=i=>e(t).doc.shuffle_questions=i),type:"checkbox",label:s.__("Shuffle Questions")},null,8,["modelValue","label"]),e(t).doc.shuffle_questions?(r(),q(e(_),{key:0,modelValue:e(t).doc.limit_questions_to,"onUpdate:modelValue":l[9]||(l[9]=i=>e(t).doc.limit_questions_to=i),label:s.__("Limit Questions To")},null,8,["modelValue","label"])):k("",!0)]),m("div",We,[d(e(_),{modelValue:e(t).doc.enable_negative_marking,"onUpdate:modelValue":l[10]||(l[10]=i=>e(t).doc.enable_negative_marking=i),type:"checkbox",label:s.__("Enable Negative Marking")},null,8,["modelValue","label"]),e(t).doc.enable_negative_marking?(r(),q(e(_),{key:0,modelValue:e(t).doc.marks_to_cut,"onUpdate:modelValue":l[11]||(l[11]=i=>e(t).doc.marks_to_cut=i),label:s.__("Marks to Deduct")},null,8,["modelValue","label"])):k("",!0)])])]),m("div",Xe,[m("div",Ge,[m("div",Ye,y(s.__("Questions")),1),e(D)?k("",!0):(r(),q(e($),{key:0,onClick:l[12]||(l[12]=i=>C())},{prefix:c(()=>[d(e(me),{class:"w-4 h-4"})]),default:c(()=>[z(" "+y(s.__("New Question")),1)]),_:1}))]),u.value.length?(r(),q(e(ve),{key:0,columns:M.value,rows:u.value,"row-key":"name",options:{showTooltip:!1}},{default:c(()=>[d(e(ce),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:c(()=>[(r(!0),p(U,null,I(M.value,i=>(r(),q(e(_e),{item:i},null,8,["item"]))),256))]),_:1}),d(e(pe),null,{default:c(()=>[(r(!0),p(U,null,I(u.value,i=>(r(),q(e(be),{row:i,onClick:R=>C(i),class:"cursor-pointer"},{default:c(({idx:R,column:A,item:j})=>[d(e(fe),{item:j},{default:c(()=>[A.key=="question_detail"?(r(),p("div",{key:0,class:"text-xs truncate h-4",innerHTML:j},null,8,Ze)):(r(),p("div",es,y(j),1))]),_:2},1032,["item"])]),_:1},8,["row","onClick"]))),256))]),_:1}),d(e(ye),null,{actions:c(({unselectAll:i,selections:R})=>[m("div",ss,[d(e($),{variant:"ghost",onClick:A=>L(R,i)},{default:c(()=>[d(e(ke),{class:"h-4 w-4 stroke-1.5"})]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])):(r(),p("div",ts,y(s.__("No questions added yet")),1))])])):k("",!0),d(Ee,{modelValue:V.value,"onUpdate:modelValue":l[13]||(l[13]=i=>V.value=i),questionDetail:b,quiz:e(t),"onUpdate:quiz":l[14]||(l[14]=i=>qe(t)?t.value=i:null),title:b.question?s.__("Edit the question"):s.__("Add a new question")},null,8,["modelValue","questionDetail","quiz","title"])],64)}}};export{as as default};
//# sourceMappingURL=QuizForm-xRvgLFMp.js.map
