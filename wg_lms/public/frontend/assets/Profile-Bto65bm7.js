import{i as z,r as B,a as v,o as d,e as t,b as S,l as $,t as c,u as e,f as u,w as p,q as U,s as D,v as O,y as T,aa as q,c as E,J as A,h as k,by as M,bz as W,bA as G,L as I,aI as H,ai as J,D as X,bB as Y,bC as K,a8 as Q,bD as Z,F as N,g as ee,bE as ae,bF as se,bG as te,bH as oe,x as le,ao as ie,p as re,z as ne,aW as de,bj as ue,B as me,E as ce,n as fe,bI as R,ab as pe}from"./index-CZIp1LU6.js";import{_ as _e}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-B2fdcvTt.js";import{T as ge}from"./TabButtons-B8hLfXVF.js";import{_ as be}from"./UserAvatar-D_gN1iLa.js";const ve={class:"border rounded-md w-1/3 mx-auto my-32"},he={class:"border-b px-5 py-3 font-medium"},ye={key:0,class:"px-5 py-3"},xe={class:"px-5 py-3"},ke={__name:"NoPermission",setup(C){const w=z("$user"),g=()=>{window.location.href="/login"};return(m,a)=>{const P=B("router-link");return d(),v("div",ve,[t("div",he,[a[1]||(a[1]=t("span",{class:"inline-flex items-center before:bg-surface-red-5 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1)),$(" "+c(m.__("Not Permitted")),1)]),e(w).data?(d(),v("div",ye,[t("div",null,c(m.__("You do not have permission to access this page.")),1),u(P,{to:{name:"Courses"}},{default:p(()=>[u(e(U),{variant:"solid",class:"mt-2"},{default:p(()=>[$(c(m.__("Checkout Courses")),1)]),_:1})]),_:1})])):S("",!0),t("div",xe,[t("div",null,c(m.__("Please login to access this page.")),1),u(e(U),{onClick:a[0]||(a[0]=b=>g()),class:"mt-4"},{default:p(()=>[$(c(m.__("Login")),1)]),_:1})])])}}},$e={class:"grid grid-cols-2 gap-5"},we={class:"space-y-4"},Pe={class:"text-xs text-ink-gray-5 mb-1"},Ce={class:"mb-4"},Se={key:1,class:"mb-4"},Ue={class:"flex items-center"},Ve=["src"],je={class:"text-base flex flex-col ml-2"},Ee={class:"text-sm text-ink-gray-4 mt-1"},Le={class:"mb-4"},Te={class:"mb-1.5 text-sm text-ink-gray-5"},Ae={__name:"EditProfile",props:D({profile:{type:Object,required:!0}},{reloadProfile:{},reloadProfileModifiers:{}}),emits:["update:reloadProfile"],setup(C){const w=O(C,"reloadProfile"),g=T(!1),m=C,a=q({first_name:"",last_name:"",headline:"",bio:"",image:""}),P=E({url:"wg_lms.lms.api.get_file_info",makeParams(s){return{file_url:s.image}},auto:!1,onSuccess(s){a.image=s}}),b=E({url:"frappe.client.set_value",makeParams(s){return{doctype:"User",name:m.profile.data.name,fieldname:{user_image:a.image.file_url,...a}}},onSuccess(s){m.profile.data=s}}),_=s=>{a.bio=Y.sanitize(K(a.bio),{ALLOWED_TAGS:["b","i","em","strong","a","p","br","ul","ol","li","img"],ALLOWED_ATTR:["href","target","src"]}),b.submit({},{onSuccess(){s(),w.value.reload(),g.value&&(g.value=!1,window.location.reload())},onError(l){var n;Q.error(((n=l.messages)==null?void 0:n[0])||l)}})},h=s=>{let l=s.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(l))return"Only image file is allowed."},f=s=>{a.image=s},o=()=>{a.image=null};return A(()=>m.profile.data,s=>{s&&(a.first_name=s.first_name,a.last_name=s.last_name,a.headline=s.headline,a.language=s.language,a.bio=s.bio,s.user_image&&P.submit({image:s.user_image}))}),A(()=>a.language,(s,l)=>{s!==l&&(g.value=!0)}),(s,l)=>(d(),k(e(X),{options:{title:"Edit your profile",size:"3xl",actions:[{label:"Save",variant:"solid",onClick:n=>_(n)}]}},{"body-content":p(()=>[t("div",$e,[t("div",we,[t("div",null,[t("div",Pe,c(s.__("Profile Image")),1),a.image?(d(),v("div",Se,[t("div",Ue,[t("img",{src:a.image.file_url,class:"object-cover h-[50px] w-[50px] rounded-full border-4 border-white object-cover"},null,8,Ve),t("div",je,[t("span",null,c(a.image.file_name),1),t("span",Ee,c(e(W)(a.image.file_size)),1)]),u(e(G),{onClick:l[1]||(l[1]=n=>o()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(d(),k(e(M),{key:0,fileTypes:["image/*"],validateFile:h,onSuccess:l[0]||(l[0]=n=>f(n))},{default:p(({file:n,progress:V,uploading:L,openFileSelector:F})=>[t("div",Ce,[u(e(U),{onClick:F,loading:L},{default:p(()=>[$(c(L?`Uploading ${V}%`:"Upload a profile image"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))]),u(e(I),{modelValue:a.first_name,"onUpdate:modelValue":l[2]||(l[2]=n=>a.first_name=n),label:s.__("First Name")},null,8,["modelValue","label"]),u(e(I),{modelValue:a.last_name,"onUpdate:modelValue":l[3]||(l[3]=n=>a.last_name=n),label:s.__("Last Name")},null,8,["modelValue","label"]),u(e(I),{modelValue:a.headline,"onUpdate:modelValue":l[4]||(l[4]=n=>a.headline=n),label:s.__("Headline")},null,8,["modelValue","label"]),u(H,{label:s.__("Language"),modelValue:a.language,"onUpdate:modelValue":l[5]||(l[5]=n=>a.language=n),doctype:"Language"},null,8,["label","modelValue"])]),t("div",null,[t("div",Le,[t("div",Te,c(s.__("Bio")),1),u(e(J),{fixedMenu:!0,onChange:l[6]||(l[6]=n=>a.bio=n),content:a.bio,editorClass:"prose-sm py-2 px-2 min-h-[200px] border-outline-gray-2 hover:border-outline-gray-3 rounded-b-md bg-surface-gray-3"},null,8,["content"])])])])]),_:1},8,["options"]))}},Fe={class:"absolute left-1/2 mt-3 w-96 max-w-lg -translate-x-1/2 transform rounded-lg bg-surface-white px-4 sm:px-0 lg:max-w-3xl"},Ie={class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},Re={class:"flex items-center justify-center space-x-2"},ze={class:""},Be={class:"relative mt-2 grid w-[25.5rem] gap-2 bg-surface-white lg:grid-cols-2"},Me=["onClick"],Ne=["src"],De={key:0,class:"mt-2 text-center text-sm text-ink-gray-4"},Oe={class:"underline",target:"_blank",href:"https://unsplash.com"},qe={__name:"EditCoverImage",emits:["select"],setup(C,{emit:w}){const g=T(null),m=w,a=E({url:"wg_lms.lms.api.get_unsplash_photos",makeParams:()=>({keyword:g.value}),auto:!0,debounce:500});A(()=>g.value,()=>{a.reload()});const P=_=>{m("select",_.file_url)},b=_=>{let h=_.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(h))return"Only image file is allowed."};return(_,h)=>(d(),k(e(oe),{transition:"default"},{target:p(({isOpen:f,togglePopover:o})=>[ae(_.$slots,"default",se(te({isOpen:f,togglePopover:o})))]),body:p(()=>[t("div",Fe,[t("div",Ie,[t("div",Re,[u(e(Z),{type:"text",placeholder:"search by keyword",modelValue:g.value,"onUpdate:modelValue":h[0]||(h[0]=f=>g.value=f),debounce:300,class:"flex-1"},null,8,["modelValue"]),u(e(M),{fileTypes:["image/*"],validateFile:b,onSuccess:h[1]||(h[1]=f=>P(f))},{default:p(({file:f,progress:o,uploading:s,openFileSelector:l})=>[t("div",ze,[u(e(U),{onClick:l,loading:s},{default:p(()=>[$(c(s?`Uploading ${o}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})]),t("div",Be,[(d(!0),v(N,null,ee(e(a).data,f=>(d(),v("button",{key:f.id,class:"h-[50px] w-[200px] overflow-hidden rounded hover:opacity-80",onClick:o=>_.$emit("select",f.urls.raw)},[t("img",{src:f.urls.raw+"&w=200&h=50&fit=crop&crop=entropy,faces,focalpoint"},null,8,Ne)],8,Me))),128))]),e(a).data?(d(),v("div",De,[$(c(_.__("Image search powered by"))+" ",1),t("a",Oe,c(_.__("Unsplash")),1)])):S("",!0)])])]),_:3}))}},We={key:1},Ge={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},He={class:"group relative h-[130px] w-full"},Je=["src"],Xe={key:2,class:"absolute bottom-[30%] md:bottom-0 left-[50%] mb-4 flex -translate-x-1/2 space-x-2 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100"},Ye={class:"mx-auto -mt-10 md:-mt-4 max-w-4xl translate-x-0 px-5"},Ke={class:"flex flex-col md:flex-row items-center"},Qe=["src"],Ze={class:"ml-6"},ea={class:"mt-2 text-3xl font-semibold text-ink-gray-9"},aa={class:"mt-2 text-base text-ink-gray-7"},sa={class:"mb-4 mt-6"},na={__name:"Profile",props:{username:{type:String,required:!0}},setup(C){const{user:w,brand:g}=le(),m=z("$user"),a=ie(),P=re(),b=T(""),_=T(!1),h=window.read_only_mode,f=C;ne(()=>{m.data&&o.reload(),l()});const o=E({url:"frappe.client.get",makeParams(r){return{doctype:"User",filters:{username:f.username}}}}),s=E({url:"frappe.client.set_value",makeParams(r){var i;return{doctype:"User",name:(i=o.data)==null?void 0:i.name,fieldname:"cover_image",value:r.url}},onSuccess(){o.reload()}}),l=()=>{let r=a.path.split("/");["certificates","roles","slots","schedule"].forEach(y=>{r.includes(y)&&(b.value=de(y))}),b.value||(b.value="About")};ue(()=>{if(b.value){let r={About:{name:"ProfileAbout"},Certificates:{name:"ProfileCertificates"},Roles:{name:"ProfileRoles"},Slots:{name:"ProfileEvaluator"},Schedule:{name:"ProfileEvaluationSchedule"}}[b.value];P.push(r)}}),A(()=>f.username,()=>{o.reload()});const n=()=>{_.value=!0},V=()=>{var r,i;return((r=m.data)==null?void 0:r.email)===((i=o.data)==null?void 0:i.email)},L=()=>{var i,y,j;let r=[{label:"About"},{label:"Certificates"}];return(i=m.data)!=null&&i.is_moderator&&r.push({label:"Roles"}),V()&&((y=m.data)!=null&&y.is_evaluator||(j=m.data)!=null&&j.is_moderator)&&(r.push({label:"Slots"}),r.push({label:"Schedule"})),r},F=me(()=>{var i,y;return[{label:"People"},{label:(i=o.data)==null?void 0:i.full_name,route:{name:"Profile",params:{username:(y=w.doc)==null?void 0:y.username}}}]});return ce(()=>{var r;return{title:(r=o.data)==null?void 0:r.full_name,icon:g.favicon}}),(r,i)=>{var j;const y=B("router-view");return d(),v(N,null,[e(m).data?e(o).data?(d(),v("div",We,[t("header",Ge,[u(e(_e),{class:"h-7",items:F.value},null,8,["items"])]),t("div",He,[e(o).data.cover_image?(d(),v("img",{key:0,src:e(o).data.cover_image,class:"h-[130px] w-full object-cover object-center"},null,8,Je)):(d(),v("div",{key:1,class:fe([{"bg-surface-gray-2":!e(o).data.cover_image},"h-[130px] w-full"])},null,2)),V()?(d(),v("div",Xe,[u(qe,{onSelect:i[0]||(i[0]=x=>e(s).submit({url:x}))},{default:p(({togglePopover:x})=>[e(h)?S("",!0):(d(),k(e(U),{key:0,variant:"outline",onClick:ta=>x()},{prefix:p(()=>[u(e(R),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:p(()=>[$(" "+c(r.__("Edit")),1)]),_:1},8,["onClick"]))]),_:1})])):S("",!0)]),t("div",Ye,[t("div",Ke,[t("div",null,[e(o).data.user_image?(d(),v("img",{key:0,src:e(o).data.user_image,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,Qe)):(d(),k(be,{key:1,user:e(o).data,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,["user"]))]),t("div",Ze,[t("h2",ea,c(e(o).data.full_name),1),t("div",aa,c(e(o).data.headline),1)]),V()&&!e(h)?(d(),k(e(U),{key:0,class:"mt-3 sm:mt-0 md:ml-auto",onClick:i[1]||(i[1]=x=>n())},{prefix:p(()=>[u(e(R),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:p(()=>[$(" "+c(r.__("Edit Profile")),1)]),_:1})):S("",!0)]),t("div",sa,[u(e(ge),{class:"inline-block",buttons:L(),modelValue:b.value,"onUpdate:modelValue":i[2]||(i[2]=x=>b.value=x)},null,8,["buttons","modelValue"])]),(d(),k(y,{profile:e(o),key:(j=e(o).data)==null?void 0:j.name},null,8,["profile"]))])])):S("",!0):(d(),k(ke,{key:0})),u(Ae,{modelValue:_.value,"onUpdate:modelValue":i[3]||(i[3]=x=>_.value=x),reloadProfile:e(o),"onUpdate:reloadProfile":i[4]||(i[4]=x=>pe(o)?o.value=x:null),profile:e(o)},null,8,["modelValue","reloadProfile","profile"])],64)}}};export{na as default};
//# sourceMappingURL=Profile-Bto65bm7.js.map
