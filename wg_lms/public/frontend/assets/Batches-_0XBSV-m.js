import{i as Y,x as G,y as n,B as k,z as W,H as X,J as Z,E as ee,r as te,a as V,o as u,e as v,f as m,h as y,b as w,u as s,w as x,q as F,l as M,t as C,P as ae,L as U,N as le,F as L,g as se}from"./index-CZIp1LU6.js";import{_ as oe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-B2fdcvTt.js";import{T as re}from"./TabButtons-B8hLfXVF.js";import{_ as ie}from"./BatchCard-C_-xkG8T.js";import{_ as ne}from"./EmptyState.vue_vue_type_script_setup_true_lang-Cua88j6p.js";import"./DateRange-CMguaU_1.js";import"./CourseInstructors-Dfde5EU7.js";import"./UserAvatar-D_gN1iLa.js";const ue={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},de={class:"p-5 pb-10"},ce={class:"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5"},ve={class:"text-lg text-ink-gray-9 font-semibold"},me={class:"flex flex-col space-y-3 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-4"},pe={class:"grid grid-cols-2 gap-2"},fe={class:"min-w-40 lg:min-w-0 lg:w-32 xl:w-40"},_e={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"},ge={key:2,class:"flex justify-center mt-5"},Ce={__name:"Batches",setup(he){var S;const r=Y("$user"),$=Y("$dayjs"),{brand:D}=G(),N=n(0),T=n(20),p=n([]),f=n(null),_=n(""),g=n(!1),a=n({}),B=k(()=>{var t;return(t=r.data)==null?void 0:t.is_student}),d=n(B.value?"All":"Upcoming"),h=n("start_date"),j=window.read_only_mode;W(()=>{E(),b(),p.value=[{label:"",value:null}]});const E=()=>{let t=new URLSearchParams(location.search);_.value=t.get("title")||"",f.value=t.get("category")||null,g.value=t.get("certification")||!1},c=X({doctype:"LMS Batch",url:"wg_lms.lms.utils.get_batches",cache:["batches",(S=r.data)==null?void 0:S.name],pageLength:T.value,start:N.value,onSuccess(t){let e=t.map(l=>l.category);e=e.filter((l,i)=>e.indexOf(l)===i&&l),p.value.length<=e.length&&H(t)}}),b=()=>{P(),c.update({filters:a.value,orderBy:h.value}),c.reload()},P=()=>{A(),q(),O(),R(),z(),Q()},A=()=>{f.value?a.value.category=f.value:delete a.value.category},q=()=>{_.value?a.value.title=["like",`%${_.value}%`]:delete a.value.title},O=()=>{g.value?a.value.certification=1:delete a.value.certification},R=()=>{h.value="start_date",r.data&&(d.value=="Enrolled"&&B.value?(a.value.enrolled=1,delete a.value.start_date,delete a.value.published,h.value="start_date desc"):B.value?delete a.value.enrolled:(delete a.value.start_date,delete a.value.published,h.value="start_date desc",d.value=="Upcoming"?(a.value.start_date=[">=",$().format("YYYY-MM-DD")],a.value.published=1,h.value="start_date"):d.value=="Archived"?a.value.start_date=["<=",$().format("YYYY-MM-DD")]:d.value=="Unpublished"&&(a.value.published=0)))},z=()=>{(!r.data||B.value&&d.value!="Enrolled")&&(a.value.start_date=[">=",$().format("YYYY-MM-DD")],a.value.published=1)},Q=()=>{let t=new URLSearchParams(location.search),e={title:_.value,category:f.value,certification:g.value};Object.keys(e).forEach(i=>{e[i]?t.set(i,e[i]):t.delete(i)});let l="";t.toString()&&(l=`?${t.toString()}`),history.replaceState({},"",`${location.pathname}${l}`)},H=t=>{t.forEach(e=>{e.category&&!p.value.find(l=>l.value===e.category)&&p.value.push({label:e.category,value:e.category})})};Z(d,()=>{b()});const I=k(()=>{var e,l,i;let t=[{label:__("All")}];return(e=r.data)!=null&&e.is_moderator||(l=r.data)!=null&&l.is_instructor||(i=r.data)!=null&&i.is_evaluator?(t.push({label:__("Upcoming")}),t.push({label:__("Archived")}),t.push({label:__("Unpublished")})):r.data&&t.push({label:__("Enrolled")}),t}),J=()=>{var t,e,l;return j?!1:!!((t=r.data)!=null&&t.is_moderator||(e=r.data)!=null&&e.is_instructor||(l=r.data)!=null&&l.is_evaluator)},K=k(()=>[{label:__("Batches"),route:{name:"Batches"}}]);return ee(()=>({title:__("Batches"),icon:D.favicon})),(t,e)=>{var i;const l=te("router-link");return u(),V(L,null,[v("header",ue,[m(s(oe),{items:K.value},null,8,["items"]),J()?(u(),y(l,{key:0,to:{name:"BatchForm",params:{batchName:"new"}}},{default:x(()=>[m(s(F),{variant:"solid"},{prefix:x(()=>[m(s(ae),{class:"h-4 w-4 stroke-1.5"})]),default:x(()=>[M(" "+C(t.__("Create")),1)]),_:1})]),_:1})):w("",!0)]),v("div",de,[v("div",ce,[v("div",ve,C(t.__("All Batches")),1),v("div",me,[s(r).data?(u(),y(s(re),{key:0,buttons:I.value,modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=o=>d.value=o),class:"w-fit"},null,8,["buttons","modelValue"])):w("",!0),v("div",pe,[m(s(U),{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=o=>_.value=o),placeholder:t.__("Search by Title"),type:"text",class:"min-w-40 lg:min-w-0 lg:w-32 xl:w-40",onInput:e[2]||(e[2]=o=>b())},null,8,["modelValue","placeholder"]),v("div",fe,[p.value.length?(u(),y(s(le),{key:0,modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=o=>f.value=o),options:p.value,placeholder:t.__("Category"),onChange:e[4]||(e[4]=o=>b())},null,8,["modelValue","options","placeholder"])):w("",!0)])]),m(s(U),{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),label:t.__("Certification"),type:"checkbox",onChange:e[6]||(e[6]=o=>b())},null,8,["modelValue","label"])])]),(i=s(c).data)!=null&&i.length?(u(),V("div",_e,[(u(!0),V(L,null,se(s(c).data,o=>(u(),y(l,{to:{name:"BatchDetail",params:{batchName:o.name}}},{default:x(()=>[m(ie,{batch:o},null,8,["batch"])]),_:2},1032,["to"]))),256))])):s(c).list.loading?w("",!0):(u(),y(ne,{key:1,type:"Batches"})),!s(c).list.loading&&s(c).hasNextPage?(u(),V("div",ge,[m(s(F),{onClick:e[7]||(e[7]=o=>s(c).next())},{default:x(()=>[M(C(t.__("Load More")),1)]),_:1})])):w("",!0)])],64)}}};export{Ce as default};
//# sourceMappingURL=Batches-_0XBSV-m.js.map
