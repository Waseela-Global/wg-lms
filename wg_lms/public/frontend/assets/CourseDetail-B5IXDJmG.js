import{d as oe,s as X,v as L,y as E,c as V,H as le,J as M,B as j,r as B,h as b,o,u as e,D as Z,w as c,e as t,f as r,L as ee,b as g,a as p,Q as ne,R as ie,F as N,g as S,S as ue,T as ce,U as de,W as me,X as _e,t as m,Y as fe,q as C,l as P,Z as z,p as se,i as D,$ as W,a0 as pe,a1 as te,G as q,a2 as ge,a3 as ve,n as O,a4 as he,a5 as ae,a6 as ye,a7 as A,a8 as U,A as be,a9 as we,aa as ke,ab as Y,x as $e,E as xe,_ as J}from"./index-CZIp1LU6.js";import{_ as Ne}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-B2fdcvTt.js";import{_ as Ce}from"./CertificationLinks-B_f1MWmY.js";import{_ as K}from"./NumberChart.vue_vue_type_script_setup_true_lang-Dp5gNzOs.js";import{_ as Re}from"./DonutChart.vue_vue_type_script_setup_true_lang-D97RY5R9.js";import{_ as Ve}from"./CourseOutline-DhBrYICy.js";import{_ as re}from"./UserAvatar-D_gN1iLa.js";import{_ as Se}from"./Rating.vue_vue_type_script_setup_true_lang-DbPnSQDw.js";import{_ as Pe}from"./CourseInstructors-Dfde5EU7.js";import{_ as ze}from"./CourseCard-Dy3xQuBt.js";import"./ECharts.vue_vue_type_script_setup_true_lang-CahjvLlX.js";import"./vuedraggable.umd-YwMGlx1c.js";import"./use-resolve-button-type-Bt-hu_zP.js";const Me={class:"flex flex-col-reverse md:flex-row justify-between md:space-x-10 text-base mt-10"},Le={class:"w-full"},Ue={class:"flex items-center justify-between space-x-5 mb-4"},Ee={class:"max-h-[70vh] overflow-y-auto"},je={key:0},Be={key:1,class:"flex justify-center my-5"},Te={class:"mb-4 self-start w-full space-y-5"},qe={class:"flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-4"},De=oe({__name:"CourseProgressSummary",props:X({courseName:{},enrollments:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const k=L(n,"modelValue"),_=E(null),v=n,f=E(v.enrollments||0),s=V({url:"wg_lms.lms.api.get_course_progress_distribution",params:{course:v.courseName},auto:!0}),h=le({doctype:"LMS Enrollment",filters:{course:v.courseName},fields:["name","member","member_name","member_image","member_username","progress"],pageLength:50,auto:!0});M([_],()=>{let l=!1,u={course:v.courseName};_.value&&(u.member_name=["like",`%${_.value}%`],l=!0),h.update({filters:u}),h.reload({},{onSuccess(d){f.value=l?d.length:v.enrollments||0}})});const $=j(()=>[{label:__("Member"),key:"member_name",width:"60%",icon:"user"},{label:__("Progress"),key:"progress",align:"right",icon:"trending-up"}]);return(l,u)=>{const d=B("router-link");return o(),b(e(Z),{modelValue:k.value,"onUpdate:modelValue":u[2]||(u[2]=y=>k.value=y),options:{title:l.__("Course Progress Summary"),size:"5xl"}},{"body-content":c(()=>{var y,R,i;return[t("div",Me,[t("div",Le,[t("div",Ue,[r(e(ee),{modelValue:_.value,"onUpdate:modelValue":u[0]||(u[0]=a=>_.value=a),placeholder:l.__("Search by Member"),type:"text",class:"w-full"},null,8,["modelValue","placeholder"])]),t("div",Ee,[e(h).loading||(y=e(h).data)!=null&&y.length?(o(),b(e(ne),{key:0,columns:$.value,rows:e(h).data,rowKey:"name",options:{selectable:!1,showTooltip:!1}},{default:c(()=>[r(e(ie),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:c(()=>[(o(!0),p(N,null,S($.value,a=>(o(),b(e(ue),{item:a,key:a.key},{prefix:c(({item:w})=>{var x;return[r(e(ce),{name:(x=w.icon)==null?void 0:x.toString(),class:"h-4 w-4"},null,8,["name"])]}),_:2},1032,["item"]))),128))]),_:1}),(o(!0),p(N,null,S(e(h).data,a=>(o(),b(e(de),null,{default:c(()=>[r(d,{to:{name:"Profile",params:{username:a.member_username}}},{default:c(()=>[r(e(me),{row:a},{default:c(({column:w,item:x})=>[r(e(_e),{item:a[w.key],align:w.align},{prefix:c(()=>[w.key=="member_name"?(o(),p("div",je,[r(e(fe),{class:"flex items-center",image:a.member_image,label:x,size:"sm"},null,8,["image","label"])])):g("",!0)]),default:c(()=>[t("div",null,m(a[w.key].toString()),1)]),_:2},1032,["item","align"])]),_:2},1032,["row"])]),_:2},1032,["to"])]),_:2},1024))),256))]),_:1},8,["columns","rows"])):g("",!0),e(h).data&&e(h).hasNextPage?(o(),p("div",Be,[r(e(C),{onClick:u[1]||(u[1]=a=>e(h).next())},{default:c(()=>[P(m(l.__("Load More")),1)]),_:1})])):g("",!0)])]),t("div",Te,[t("div",qe,[r(e(K),{class:"border rounded-md w-full",config:{title:l.__("Enrollments"),value:f.value||0}},null,8,["config"]),r(e(K),{class:"border rounded-md w-full",config:{title:l.__("Average Progress %"),value:((R=e(s).data)==null?void 0:R.average_progress)||0}},null,8,["config"])]),r(e(Re),{config:{data:((i=e(s).data)==null?void 0:i.progress_distribution)||[],title:l.__("Progress Distribution"),categoryColumn:"category",valueColumn:"count",colors:[e(z).colors.red[400],e(z).colors.amber[400],e(z).colors.pink[400],e(z).colors.blue[400],e(z).colors.green[400]]}},null,8,["config"])])])]}),_:1},8,["modelValue","options"])}}}),Oe={class:"border-2 rounded-md min-w-80 max-w-sm"},Ae=["src"],Ie={class:"p-5"},Fe={key:0,class:"text-2xl font-semibold mb-3"},Ge={key:1},He={key:0,class:"space-y-2"},We={class:"space-y-4"},Ye={class:"flex items-center text-ink-gray-9"},Je={class:"ml-2"},Ke={class:"flex items-center text-ink-gray-9"},Qe={class:"ml-2"},Xe={key:0,class:"flex items-center text-ink-gray-9"},Ze={class:"ml-2"},es={key:1,class:"flex items-center font-semibold text-ink-gray-9"},ss={class:"ml-2"},ts={key:2,class:"flex items-center font-semibold text-ink-gray-9"},as={class:"ml-2"},Q={__name:"CourseCardOverlay",props:{course:{type:Object,default:null}},setup(n){const k=se(),_=D("$user"),v=E(!1),f=window.read_only_mode,s=n,h=j(()=>s.course.data.video_link?"https://www.youtube.com/embed/"+s.course.data.video_link:null);function $(){_.data?be("wg_lms.lms.doctype.lms_enrollment.lms_enrollment.create_membership",{course:s.course.data.name}).then(()=>{we("enrolled_in_course",{course:s.course.data.name}),U.success(__("You have been enrolled in this course")),setTimeout(()=>{k.push({name:"Lesson",params:{courseName:s.course.data.name,chapterNumber:1,lessonNumber:1}})},1e3)}).catch(i=>{var a;U.warning(__(((a=i.messages)==null?void 0:a[0])||i)),console.error(i)}):(U.success(__("You need to login first to enroll for this course")),setTimeout(()=>{window.location.href=`/login?redirect-to=${window.location.pathname}`},500))}const l=()=>{let i=!1;return s.course.data.instructors.forEach(a=>{var w;!i&&a.name==((w=_.data)==null?void 0:w.name)&&(i=!0)}),i},u=j(()=>{var i,a,w;return!!((i=s.course.data)!=null&&i.enable_certification&&((w=(a=s.course.data)==null?void 0:a.membership)==null?void 0:w.progress)==100)}),d=V({url:"wg_lms.lms.doctype.lms_certificate.lms_certificate.create_certificate",makeParams(i){return{course:i.course}},onSuccess(i){window.open(`/api/method/frappe.utils.print_format.download_pdf?doctype=LMS+Certificate&name=${i.name}&format=${encodeURIComponent(i.template)}`,"_blank")}}),y=()=>{var i,a;d.submit({course:(i=s.course.data)==null?void 0:i.name,member:(a=_.data)==null?void 0:a.name})},R=()=>{v.value=!0};return(i,a)=>{var x,I,F,G,H;const w=B("router-link");return o(),p(N,null,[t("div",Oe,[n.course.data.video_link?(o(),p("iframe",{key:0,src:h.value,class:"rounded-t-md min-h-56 w-full"},null,8,Ae)):g("",!0),t("div",Ie,[n.course.data.paid_course?(o(),p("div",Fe,m(n.course.data.price),1)):g("",!0),e(f)?g("",!0):(o(),p("div",Ge,[n.course.data.membership?(o(),p("div",He,[r(w,{to:{name:"Lesson",params:{courseName:n.course.name,chapterNumber:n.course.data.current_lesson?n.course.data.current_lesson.split("-")[0]:1,lessonNumber:n.course.data.current_lesson?n.course.data.current_lesson.split("-")[1]:1}}},{default:c(()=>[r(e(C),{variant:"solid",size:"md",class:"w-full"},{prefix:c(()=>[r(e(W),{class:"size-4 stroke-1.5"})]),default:c(()=>[t("span",null,m(i.__("Continue Learning")),1)]),_:1})]),_:1},8,["to"]),r(Ce,{courseName:n.course.data.name,class:"w-full"},null,8,["courseName"])])):n.course.data.paid_course?(o(),b(w,{key:1,to:{name:"Billing",params:{type:"course",name:n.course.data.name}}},{default:c(()=>[r(e(C),{variant:"solid",size:"md",class:"w-full"},{prefix:c(()=>[r(e(pe),{class:"size-4 stroke-1.5"})]),default:c(()=>[t("span",null,m(i.__("Buy this course")),1)]),_:1})]),_:1},8,["to"])):n.course.data.disable_self_learning?(o(),b(e(te),{key:2,theme:"blue",size:"lg"},{default:c(()=>[P(m(i.__("Contact the Administrator to enroll for this course.")),1)]),_:1})):!((x=e(_).data)!=null&&x.is_moderator)&&!l()?(o(),b(e(C),{key:3,onClick:a[0]||(a[0]=T=>$()),variant:"solid",class:"w-full",size:"md"},{prefix:c(()=>[r(e(W),{class:"size-4 stroke-1.5"})]),default:c(()=>[t("span",null,m(i.__("Start Learning")),1)]),_:1})):g("",!0),u.value?(o(),b(e(C),{key:4,onClick:a[1]||(a[1]=T=>y()),variant:"subtle",class:"w-full mt-2",size:"md"},{prefix:c(()=>[r(e(q),{class:"size-4 stroke-1.5"})]),default:c(()=>[P(" "+m(i.__("Get Certificate")),1)]),_:1})):g("",!0),(I=e(_).data)!=null&&I.is_moderator||l()?(o(),b(e(C),{key:5,class:"w-full mt-2",size:"md",onClick:R},{prefix:c(()=>[r(e(ge),{class:"size-4 stroke-1.5"}),P(" "+m(i.__("Progress Summary")),1)]),_:1})):g("",!0),(G=(F=e(_))==null?void 0:F.data)!=null&&G.is_moderator||l()?(o(),b(w,{key:6,to:{name:"CourseForm",params:{courseName:n.course.data.name}}},{default:c(()=>[r(e(C),{variant:"subtle",class:"w-full mt-2",size:"md"},{prefix:c(()=>[r(e(ve),{class:"size-4 stroke-1.5"})]),default:c(()=>[t("span",null,m(i.__("Edit")),1)]),_:1})]),_:1},8,["to"])):g("",!0)])),t("div",We,[t("div",{class:O(["font-medium text-ink-gray-9",{"mt-8":!e(f)}])},m(i.__("This course has:")),3),t("div",Ye,[r(e(he),{class:"h-4 w-4 stroke-1.5"}),t("span",Je,m(n.course.data.lessons)+" "+m(i.__("Lessons")),1)]),t("div",Ke,[r(e(ae),{class:"h-4 w-4 stroke-1.5"}),t("span",Qe,m(e(ye)(n.course.data.enrollments))+" "+m(i.__("Enrolled Students")),1)]),parseInt(n.course.data.rating)>0?(o(),p("div",Xe,[r(e(A),{class:"size-4 stroke-1.5 fill-yellow-500 text-transparent"}),t("span",Ze,m(n.course.data.rating)+" "+m(i.__("Rating")),1)])):g("",!0),n.course.data.enable_certification?(o(),p("div",es,[r(e(q),{class:"h-4 w-4 stroke-2"}),t("span",ss,m(i.__("Certificate of Completion")),1)])):g("",!0),n.course.data.paid_certificate?(o(),p("div",ts,[r(e(q),{class:"h-4 w-4 stroke-2"}),t("span",as,m(i.__("Paid Certificate after Evaluation")),1)])):g("",!0)])])]),(H=e(_).data)!=null&&H.is_moderator||l()?(o(),b(De,{key:0,modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=T=>v.value=T),courseName:n.course.data.name,enrollments:n.course.data.enrollments},null,8,["modelValue","courseName","enrollments"])):g("",!0)],64)}}},rs={class:"flex flex-col gap-4"},os={__name:"ReviewModal",props:X({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{},reloadReviews:{},reloadReviewsModifiers:{},hasReviewed:{},hasReviewedModifiers:{}}),emits:["update:modelValue","update:reloadReviews","update:hasReviewed"],setup(n){const k=L(n,"modelValue"),_=L(n,"reloadReviews"),v=L(n,"hasReviewed");let f=ke({review:"",rating:0});const s=n,h=V({url:"frappe.client.insert",makeParams(l){return{doc:{doctype:"LMS Course Review",course:s.courseName,...l}}}});function $(l){f.rating=f.rating/5,h.submit(f,{validate(){if(!f.rating)return"Please enter a rating."},onSuccess(){_.value.reload(),v.value.reload()},onError(u){var d;U.error(((d=u.messages)==null?void 0:d[0])||u)}}),l()}return(l,u)=>(o(),b(e(Z),{modelValue:k.value,"onUpdate:modelValue":u[2]||(u[2]=d=>k.value=d),options:{title:l.__("Write a Review"),size:"xl",actions:[{label:"Submit",variant:"solid",onClick:d=>$(d)}]}},{"body-content":c(()=>[t("div",rs,[r(e(Se),{modelValue:e(f).rating,"onUpdate:modelValue":u[0]||(u[0]=d=>e(f).rating=d),label:l.__("Rating")},null,8,["modelValue","label"]),r(e(ee),{label:l.__("Review"),type:"textarea",modelValue:e(f).review,"onUpdate:modelValue":u[1]||(u[1]=d=>e(f).review=d),rows:5},null,8,["label","modelValue"])])]),_:1},8,["modelValue","options"]))}},ls={key:0,class:"mt-20 mb-10"},ns={class:"flex items-center font-semibold text-2xl text-ink-gray-9"},is={class:"grid gap-8 mt-10"},us={class:"flex items-center"},cs={class:"mx-4"},ds={class:"text-lg font-medium mr-4 text-ink-gray-7"},ms={class:"text-ink-gray-7"},_s={class:"flex mt-2 space-x-1"},fs={key:0,class:"mt-4 leading-5 text-ink-gray-7"},ps={__name:"CourseReviews",props:{courseName:{type:String,required:!0},avg_rating:{type:String,required:!0},membership:{type:Object,required:!1}},setup(n){var $,l,u;const k=D("$user"),_=n,v=V({url:"frappe.client.get_count",cache:["eligible_to_review",_.courseName,($=_.membership)==null?void 0:$.member],params:{doctype:"LMS Course Review",filters:{course:_.courseName,owner:(l=_.membership)==null?void 0:l.member}},auto:!!((u=k.data)!=null&&u.name)}),f=V({url:"wg_lms.lms.utils.get_reviews",cache:["course_reviews",_.courseName],makeParams(){return{course:_.courseName}},auto:!0});M(()=>_.courseName,()=>{f.reload()});const s=E(!1);function h(){s.value=!0}return(d,y)=>{var i;const R=B("router-link");return o(),p(N,null,[(i=e(f).data)!=null&&i.length||n.membership?(o(),p("div",ls,[n.membership&&!e(v).data?(o(),b(e(C),{key:0,onClick:y[0]||(y[0]=a=>h()),class:"float-right"},{default:c(()=>[P(m(d.__("Write a Review")),1)]),_:1})):g("",!0),t("div",ns,m(d.__("Student Reviews")),1),t("div",is,[(o(!0),p(N,null,S(e(f).data,(a,w)=>(o(),p("div",null,[t("div",us,[r(R,{to:{name:"Profile",params:{username:a.owner_details.username}}},{default:c(()=>[r(re,{user:a.owner_details,size:"2xl"},null,8,["user"])]),_:2},1032,["to"]),t("div",cs,[r(R,{to:{name:"Profile",params:{username:a.owner_details.username}}},{default:c(()=>[t("span",ds,m(a.owner_details.full_name),1)]),_:2},1032,["to"]),t("span",ms,m(a.creation),1),t("div",_s,[(o(),p(N,null,S(5,x=>r(e(A),{class:O(["size-4 text-transparent rounded-sm",x<=Math.ceil(a.rating)?"fill-yellow-500":"fill-gray-300"])},null,8,["class"])),64))])])]),a.review?(o(),p("div",fs,m(a.review),1)):g("",!0)]))),256))])])):g("",!0),r(os,{modelValue:s.value,"onUpdate:modelValue":y[1]||(y[1]=a=>s.value=a),reloadReviews:e(f),"onUpdate:reloadReviews":y[2]||(y[2]=a=>Y(f)?f.value=a:null),hasReviewed:e(v),"onUpdate:hasReviewed":y[3]||(y[3]=a=>Y(v)?v.value=a:null),courseName:n.courseName},null,8,["modelValue","reloadReviews","hasReviewed","courseName"])],64)}}},gs={key:0,class:"mt-10"},vs={class:"flex items-center justify-between mb-6"},hs={class:"text-2xl font-semibold text-ink-gray-9"},ys={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4"},bs={__name:"RelatedCourses",props:{courseName:{type:String,required:!0}},setup(n){const k=n,_=V({url:"wg_lms.lms.utils.get_related_courses",cache:["related_courses",k.courseName],makeParams(){return{course:k.courseName}},auto:!0});return M(()=>k.courseName,()=>{_.reload()}),(v,f)=>{var h;const s=B("router-link");return(h=e(_).data)!=null&&h.length?(o(),p("div",gs,[t("div",vs,[t("div",hs,m(v.__("Related Courses")),1)]),t("div",ys,[(o(!0),p(N,null,S(e(_).data,$=>(o(),b(s,{key:$.name,to:{name:"CourseDetail",params:{courseName:$.name}},class:"cursor-pointer"},{default:c(()=>[r(ze,{course:$},null,8,["course"])]),_:2},1032,["to"]))),128))])])):g("",!0)}}},ws={key:0},ks={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},$s={class:"m-5"},xs={class:"flex justify-between w-full space-x-5"},Ns={class:"md:w-2/3"},Cs={class:"text-3xl font-semibold text-ink-gray-9"},Rs={class:"my-3 leading-6 text-ink-gray-7"},Vs={class:"flex items-center"},Ss={class:"ml-1 text-ink-gray-7"},Ps={key:1,class:"mx-3"},zs={class:"ml-1"},Ms={key:3,class:"mx-3"},Ls={class:"flex items-center"},Us={key:0,class:"flex my-4 w-fit"},Es={class:"md:hidden my-4"},js=["innerHTML"],Bs={class:"mt-10"},Ts={class:"hidden md:block"},Xs={__name:"CourseDetail",props:{courseName:{type:String,required:!0}},setup(n){const{brand:k}=$e(),_=se(),v=D("$user"),f=n,s=V({url:"wg_lms.lms.utils.get_course_details",cache:["course",f.courseName],makeParams(){return{course:f.courseName}},auto:!0});M(()=>f.courseName,()=>{s.reload()}),M(s,()=>{var l,u,d;!h()&&!((l=v.data)!=null&&l.is_moderator)&&!((u=s.data)!=null&&u.published)&&!((d=s.data)!=null&&d.upcoming)&&_.push({name:"Courses"})});const h=()=>{var u;let l=!1;return(u=s.data)==null||u.instructors.forEach(d=>{var y;!l&&d.name==((y=v.data)==null?void 0:y.name)&&(l=!0)}),l},$=j(()=>{var u,d;let l=[{label:"Courses",route:{name:"Courses"}}];return l.push({label:(u=s==null?void 0:s.data)==null?void 0:u.title,route:{name:"CourseDetail",params:{courseName:(d=s==null?void 0:s.data)==null?void 0:d.name}}}),l});return xe(()=>{var l;return{title:(l=s==null?void 0:s.data)==null?void 0:l.title,icon:k.favicon}}),(l,u)=>e(s).data?(o(),p("div",ws,[t("header",ks,[r(e(Ne),{class:"h-7",items:$.value},null,8,["items"])]),t("div",$s,[t("div",xs,[t("div",Ns,[t("div",Cs,m(e(s).data.title),1),t("div",Rs,m(e(s).data.short_introduction),1),t("div",Vs,[parseInt(e(s).data.rating)>0?(o(),b(e(J),{key:0,text:l.__("Average Rating"),class:"flex items-center"},{default:c(()=>[r(e(A),{class:"size-4 text-transparent fill-yellow-500"}),t("span",Ss,m(e(s).data.rating),1)]),_:1},8,["text"])):g("",!0),parseInt(e(s).data.rating)>0?(o(),p("span",Ps,"·")):g("",!0),e(s).data.enrollment_count?(o(),b(e(J),{key:2,text:l.__("Enrolled Students"),class:"flex items-center"},{default:c(()=>[r(e(ae),{class:"h-4 w-4 text-ink-gray-7"}),t("span",zs,m(e(s).data.enrollment_count_formatted),1)]),_:1},8,["text"])):g("",!0),e(s).data.enrollment_count?(o(),p("span",Ms,"·")):g("",!0),t("div",Ls,[t("span",{class:O(["h-6 mr-1",{"avatar-group overlap":e(s).data.instructors.length>1}])},[(o(!0),p(N,null,S(e(s).data.instructors,d=>(o(),b(re,{user:d},null,8,["user"]))),256))],2),r(Pe,{instructors:e(s).data.instructors},null,8,["instructors"])])]),e(s).data.tags?(o(),p("div",Us,[(o(!0),p(N,null,S(e(s).data.tags.split(", "),d=>(o(),b(e(te),{theme:"gray",size:"lg",class:"mr-2 text-ink-gray-9"},{default:c(()=>[P(m(d),1)]),_:2},1024))),256))])):g("",!0),t("div",Es,[r(Q,{course:e(s)},null,8,["course"])]),t("div",{innerHTML:e(s).data.description,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-10"},null,8,js),t("div",Bs,[r(Ve,{title:l.__("Course Outline"),courseName:e(s).data.name,showOutline:!0,getProgress:!!e(s).data.membership},null,8,["title","courseName","getProgress"])]),r(ps,{courseName:e(s).data.name,avg_rating:e(s).data.rating,membership:e(s).data.membership},null,8,["courseName","avg_rating","membership"])]),t("div",Ts,[r(Q,{course:e(s)},null,8,["course"])])]),r(bs,{courseName:e(s).data.name},null,8,["courseName"])])])):g("",!0)}};export{Xs as default};
//# sourceMappingURL=CourseDetail-B5IXDJmG.js.map
