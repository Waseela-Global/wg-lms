<template>
	<Button
		v-if="certification.data && certification.data.certificate"
		@click="downloadCertificate"
		class=""
	>
		<template #prefix>
			<GraduationCap class="size-4 stroke-1.5" />
		</template>
		{{ __('View Certificate') }}
	</Button>
</template>
<script setup>
import { Button, createResource } from 'frappe-ui'
import { inject } from 'vue'
import { GraduationCap } from 'lucide-vue-next'

const user = inject('$user')

const props = defineProps({
	courseName: {
		type: String,
		required: true,
	},
})

const certification = createResource({
	url: 'wg_lms.lms.api.get_certification_details',
	params: {
		course: props.courseName,
	},
	auto: user.data ? true : false,
	cache: ['certificationData', user.data?.name],
})

const downloadCertificate = () => {
	window.open(
		`/api/method/frappe.utils.print_format.download_pdf?doctype=LMS+Certificate&name=${
			certification.data.certificate.name
		}&format=${encodeURIComponent(certification.data.certificate.template)}`
	)
}
</script>
